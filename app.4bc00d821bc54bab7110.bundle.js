!function(){"use strict";var e={213:function(e,t,i){i.r(t)},844:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var r=n(i(632)),s=i(648),o=function(){function e(){var e=this;this.worldSideSize=100,this.engine=new r.default(this.worldSideSize),this.canvas=document.createElement("canvas"),this.isStarted=!1,this.frameHeight=10,this.frameWidth=10,this.framePositionX=0,this.framePositionY=0,this.realMousePosition={x:0,y:0},this.virtualMousePosition={x:0,y:0},this.matterType=0,this.pointerSquareSize=0,this.isPause=!1,this.lastFrame=0,document.body.appendChild(this.canvas);var t=function(e,t){var i=e.getBoundingClientRect(),n=t.touches[0],r=e.width/i.width,s=e.height/i.height;return{x:(n.clientX-i.left)*r,y:(n.clientY-i.top)*s}},i=function(t){e.realMousePosition=t;var i=e.renderer.getPixelSize();e.virtualMousePosition.x=e.framePositionX+Math.floor(t.x/i),e.virtualMousePosition.y=e.framePositionY+(e.frameHeight-1-Math.floor(t.y/i)),e.engine.setMousedPosition(e.virtualMousePosition)};this.canvas.addEventListener("mousemove",(function(t){var n=function(e,t){var i=e.getBoundingClientRect(),n=e.width/i.width,r=e.height/i.height;return{x:(t.clientX-i.left)*n,y:(t.clientY-i.top)*r}}(e.canvas,t);i(n)}),!1),this.canvas.addEventListener("touchmove",(function(n){var r=t(e.canvas,n);i(r)}),!1),this.canvas.addEventListener("wheel",(function(t){t.deltaY<0?e.pointerSquareSize>0&&(e.pointerSquareSize-=1):t.deltaY>0&&e.pointerSquareSize<2*e.frameHeight&&(e.pointerSquareSize+=1)}),!1);var n,o,a,u,h;n=this.canvas,o=function(){return e.engine.createUnitAtPoint(e.virtualMousePosition,e.matterType,e.pointerSquareSize)},u=function(n){if("mousedown"===n.type&&n instanceof MouseEvent)0===n.button&&(a=window.setInterval(o,1));else if(n instanceof TouchEvent){var r=t(e.canvas,n);i(r),a=window.setInterval(o,1)}},h=function(){a&&window.clearInterval(a)},n.addEventListener("mousedown",u),n.addEventListener("mouseup",h),n.addEventListener("mouseout",h),n.addEventListener("touchstart",u),n.addEventListener("touchend",h),this.canvas.addEventListener("mousedown",(function(t){1===t.button&&(e.matterType<3?e.matterType+=1:e.matterType=0)}),!1),this.renderer=new s.Renderer(this.canvas),document.addEventListener("keydown",(function(t){"ArrowRight"===t.key&&e.framePositionX<e.worldSideSize-e.frameWidth&&(e.framePositionX+=1),"ArrowLeft"===t.key&&e.framePositionX>0&&(e.framePositionX-=1),"ArrowUp"===t.key&&e.framePositionY<e.worldSideSize-e.frameHeight&&(e.framePositionY+=1),"ArrowDown"===t.key&&e.framePositionY>0&&(e.framePositionY-=1)," "===t.key&&(e.isPause=!e.isPause)}))}return e.prototype.setScreenSize=function(e,t){this.renderer.setScreenSize(e,t),this.engine.setRendererSize(Math.floor(e/this.renderer.getPixelSize()),Math.floor(t/this.renderer.getPixelSize())),this.frameWidth=Math.floor(e/this.renderer.getPixelSize()),this.frameHeight=Math.floor(t/this.renderer.getPixelSize())},e.prototype.setPixelSize=function(e){this.renderer.setPixelSize(e),this.engine.setRendererSize(Math.floor(this.renderer.getScreenSizeX()/this.renderer.getPixelSize()),Math.floor(this.renderer.getScreenSizeY()/this.renderer.getPixelSize())),this.frameWidth=Math.floor(this.renderer.getScreenSizeX()/this.renderer.getPixelSize()),this.frameHeight=Math.floor(this.renderer.getScreenSizeY()/this.renderer.getPixelSize())},e.prototype.start=function(){this.isStarted||(this.renderer.getPixels().fill(4278190080),this.isStarted=!0,this.startRender())},e.prototype.startRender=function(){var e=this,t=function(){e.isPause||Date.now()-e.lastFrame>=12&&(e.renderer.setPixels(e.engine.requestFrame(e.frameWidth,e.frameHeight,e.framePositionX,e.framePositionY)),e.renderer.render(),e.lastFrame=Date.now()),window.requestAnimationFrame(t)};t()},e}();t.App=o},632:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(i(575)),s=n(i(199)),o=n(i(283)),a=function(){function e(e){this.frameWidth=0,this.frameHeight=0,this.framePositionX=0,this.framePositionY=0,this.physicEngine=new r.default,this.worldSquareSide=2,this.mousePosition={x:0,y:0},this.lastUnitId=0,this.gameWorldState=Array.from(Array(4),(function(){return new Array(4)})),this.worldSquareSide=e,this.gameWorldState=Array.from(Array(e),(function(){return new Array(e)}))}return e.prototype.setMousedPosition=function(e){this.mousePosition=e},e.prototype.setRendererSize=function(e,t){this.frameWidth=e,this.frameHeight=t},e.prototype.extractFrame=function(e,t,i,n){for(var r,s=new Uint32Array(e*t),o=(t-1)*e,a=n;a<n+t;a+=1){for(var u=i;u<i+e;u+=1)null!==this.gameWorldState[u][a]&&(s[o]=(null===(r=this.gameWorldState[u][a])||void 0===r?void 0:r.unitType.unitColor)||0),o+=1;o-=2*e}return s},e.prototype.createUnitAtPoint=function(e,t,i){var n=this,r=function(){var e=!1,i=0,r=!1;switch(t){case 0:e=!0,i+=2013255936;break;case 1:i+=4278241994+((a=(0,o.default)(10,53))+a*Math.pow(16,2));break;case 2:var a;r=!0,i+=4286677377+((a=(0,o.default)(10,82))+a*Math.pow(16,2)+a*Math.pow(16,4));break;case 3:return null}return new s.default({unitHealth:1,unitIsGas:!1,unitIsFlammable:!1,unitIsLiquid:e,unitIsStatic:r,unitColor:i},null,n.lastUnitId++)};if(i>0)for(var a=Math.floor(e.x/i)*i,u=Math.floor(e.y/i)*i,h=0;h<i;h+=1)for(var d=0;d<i;d+=1){var l=r();this.gameWorldState[a+d][u+h]&&null!==l||(this.gameWorldState[a+d][u+h]=l)}else this.gameWorldState[e.x][e.y]||(this.gameWorldState[e.x][e.y]=r())},e.prototype.requestFrame=function(e,t,i,n){return this.gameWorldState=this.physicEngine.resolveWorld(this.gameWorldState,this.worldSquareSide),this.extractFrame(e,t,i,n)},e}();t.default=a},575:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(i(283)),s=function(){function e(){}return e.prototype.resolveWorld=function(e,t){for(var i,n=0;n<t;n+=1)for(var s=0;s<t;s+=1)null!=e[s][n]&&((null===(i=e[s][n])||void 0===i?void 0:i.unitType.unitIsStatic)||(e[s][n].isUpdated=!1));var o=function(i,n){var s,o;null!=e[i][n]&&((null===(s=e[i][n])||void 0===s?void 0:s.unitType.unitIsStatic)||(null===(o=e[i][n])||void 0===o?void 0:o.unitType.unitIsGas)||(function(i,n){var s,o,a,u,h,d,l,f,c,v,p,S;if(n>0&&null!==e[i][n]&&!(null===(s=e[i][n])||void 0===s?void 0:s.isUpdated)&&!(null===(o=e[i][n])||void 0===o?void 0:o.unitType.unitIsLiquid))if(!e[i][n-1]||(null===(a=e[i][n-1])||void 0===a?void 0:a.unitType.unitIsLiquid))if(null===(u=e[i][n-1])||void 0===u?void 0:u.unitType.unitIsLiquid){if(n<t-1)if(e[i][n+1])i>0&&!e[i-1][n]?(m=e[i][n-1],e[i][n-1]=e[i][n],e[i-1][n]=m):i<t-1&&!e[i+1][n]?(m=e[i][n-1],e[i][n-1]=e[i][n],e[i+1][n]=m):(m=e[i][n-1],e[i][n-1]=e[i][n],e[i][n]=m);else{var m=e[i][n-1];e[i][n-1]=e[i][n],e[i][n]=m}}else e[i][n-1]=e[i][n],e[i][n-1].isUpdated=!0,e[i][n]=null;else if(i>0&&i<t-1&&(!e[i-1][n-1]&&!e[i+1][n-1]||(null===(h=e[i-1][n-1])||void 0===h?void 0:h.unitType.unitIsLiquid)&&(null===(d=e[i+1][n-1])||void 0===d?void 0:d.unitType.unitIsLiquid))&&(!e[i-1][n]&&!e[i+1][n]||(null===(l=e[i-1][n])||void 0===l?void 0:l.unitType.unitIsLiquid)&&(null===(f=e[i+1][n])||void 0===f?void 0:f.unitType.unitIsLiquid)))0===(0,r.default)(0,1)?(m=e[i-1][n-1],e[i-1][n-1]=e[i][n],e[i-1][n-1].isUpdated=!0,e[i][n]=m):(m=e[i+1][n-1],e[i+1][n-1]=e[i][n],e[i+1][n-1].isUpdated=!0,e[i][n]=m);else if(!(i>0)||e[i-1][n-1]&&!(null===(c=e[i-1][n-1])||void 0===c?void 0:c.unitType.unitIsLiquid)||e[i-1][n]&&!(null===(v=e[i-1][n])||void 0===v?void 0:v.unitType.unitIsLiquid))!(i<t-1)||e[i+1][n-1]&&!(null===(p=e[i+1][n-1])||void 0===p?void 0:p.unitType.unitIsLiquid)||e[i+1][n]&&!(null===(S=e[i+1][n])||void 0===S?void 0:S.unitType.unitIsLiquid)||(m=e[i+1][n-1],e[i+1][n-1]=e[i][n],e[i+1][n-1].isUpdated=!0,e[i][n]=m);else{m=e[i-1][n-1];e[i-1][n-1]=e[i][n],e[i-1][n-1].isUpdated=!0,e[i][n]=m}}(i,n),function(i,n){var s,o;null!==e[i][n]&&!(null===(s=e[i][n])||void 0===s?void 0:s.isUpdated)&&(null===(o=e[i][n])||void 0===o?void 0:o.unitType.unitIsLiquid)&&(n>0?e[i][n-1]?i>0&&!e[i-1][n-1]&&!e[i-1][n]&&i<t-1&&!e[i+1][n-1]&&!e[i+1][n]?0===(0,r.default)(0,1)?(e[i-1][n-1]=e[i][n],e[i-1][n-1].isUpdated=!0,e[i][n]=null):(e[i+1][n-1]=e[i][n],e[i+1][n-1].isUpdated=!0,e[i][n]=null):i>0&&!e[i-1][n-1]&&!e[i-1][n]?(e[i-1][n-1]=e[i][n],e[i-1][n-1].isUpdated=!0,e[i][n]=null):i<t-1&&!e[i+1][n-1]&&!e[i+1][n]?(e[i+1][n-1]=e[i][n],e[i+1][n-1].isUpdated=!0,e[i][n]=null):i<t-1&&!e[i+1][n]?(e[i+1][n]=e[i][n],e[i+1][n].isUpdated=!0,e[i][n]=null):i>0&&!e[i-1][n]&&(e[i-1][n]=e[i][n],e[i-1][n].isUpdated=!0,e[i][n]=null):(e[i][n-1]=e[i][n],e[i][n-1].isUpdated=!0,e[i][n]=null):0===n&&(i>0&&!e[i-1][n]?(e[i-1][n]=e[i][n],e[i-1][n].isUpdated=!0,e[i][n]=null):i<t-1&&!e[i+1][n]&&(e[i+1][n]=e[i][n],e[i+1][n].isUpdated=!0,e[i][n]=null)))}(i,n)))};for(n=0;n<t;n+=1){if(!1===Boolean((0,r.default)(0,1)))for(s=0;s<t;s+=1)o(s,n);else for(s=t-1;s>0;s-=1)o(s,n)}return e},e}();t.default=s},648:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0;var i=function(){function e(e){var t=this;this.pixelSize=1,this.wallColor=4278190080,this.lastFrameTime=(new Date).getTime(),this.getScreenSizeX=function(){return t.width},this.getScreenSizeY=function(){return t.height},this.getPixelsCount=function(){return t.width*t.height/Math.pow(t.pixelSize,2)},this.getPixelSize=function(){return t.pixelSize},this.canvas=e,this.width=this.canvas.width,this.height=this.canvas.height,this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))}return e.prototype.setScreenSize=function(e,t){this.canvas.width=e,this.canvas.height=t,this.width=this.canvas.width,this.height=this.canvas.height,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))},e.prototype.setPixelSize=function(e){this.pixelSize=e,this.setScreenSize(this.width,this.height)},e.prototype.render=function(){for(var e=function(e,t,i,n){return(n-t-1)*i+e},t=0;t<this.height/this.pixelSize;t++)for(var i=0;i<this.width/this.pixelSize;i++)for(var n=0;n<this.pixelSize;n++)for(var r=0;r<this.pixelSize;r++){var s=e(i*this.pixelSize+n,t*this.pixelSize+r,this.width,this.height),o=e(i,t,this.width/this.pixelSize,this.height/this.pixelSize);this.realPixels[s]=this.virtualPixels[o]}this.ctx.putImageData(this.imageData,0,0),this.ctx.font="10px serif",1e3/((new Date).getTime()-this.lastFrameTime)==1/0&&(this.lastFrameTime=(new Date).getTime()),this.ctx.fillText("FPS: ".concat(String(1e3/((new Date).getTime()-this.lastFrameTime))),0,10),this.ctx.fillStyle="red",this.lastFrameTime=(new Date).getTime()},e.prototype.getPixels=function(){return this.virtualPixels},e.prototype.setPixels=function(e){this.virtualPixels=e},e}();t.Renderer=i},199:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=0),this.isUpdated=!1,this.unitType=e,this.unitVelocityVector=t,this.unitId=i};t.default=i},283:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){var i=Math.ceil(e),n=Math.floor(t);return Math.floor(Math.random()*(n-i+1))+i}}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};!function(){i(213);var e=new(i(844).App);e.setScreenSize(1e3,1e3),e.setPixelSize(10),e.renderer.render(),e.start()}()}();