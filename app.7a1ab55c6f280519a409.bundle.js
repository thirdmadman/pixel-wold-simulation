!function(){"use strict";var e={213:function(e,t,i){i.r(t)},844:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var r=n(i(632)),o=i(648),a=function(){function e(){var e=this;this.worldSideSize=1e3,this.engine=new r.default(this.worldSideSize),this.canvas=document.createElement("canvas"),this.isStarted=!1,this.frameHeight=10,this.frameWidth=10,this.framePositionX=0,this.framePositionY=0,this.realMousePosition={x:0,y:0},this.virtualMousePosition={x:0,y:0},this.matterType=0,this.pointerSquareSize=0,this.isPause=!1,document.body.appendChild(this.canvas);var t=function(e,t){var i=e.getBoundingClientRect(),n=t.touches[0],r=e.width/i.width,o=e.height/i.height;return{x:(n.clientX-i.left)*r,y:(n.clientY-i.top)*o}},i=function(t){e.realMousePosition=t;var i=e.renderer.getPixelSize();e.virtualMousePosition.x=e.framePositionX+Math.floor(t.x/i),e.virtualMousePosition.y=e.framePositionY+(e.frameHeight-1-Math.floor(t.y/i)),e.engine.setMousedPosition(e.virtualMousePosition)};this.canvas.addEventListener("mousemove",(function(t){var n=function(e,t){var i=e.getBoundingClientRect(),n=e.width/i.width,r=e.height/i.height;return{x:(t.clientX-i.left)*n,y:(t.clientY-i.top)*r}}(e.canvas,t);i(n)}),!1),this.canvas.addEventListener("touchmove",(function(n){var r=t(e.canvas,n);i(r)}),!1),this.canvas.addEventListener("wheel",(function(t){-t.deltaY<0?e.pointerSquareSize>0&&(e.pointerSquareSize-=1):-t.deltaY>0&&e.pointerSquareSize<2*e.frameHeight&&(e.pointerSquareSize+=1)}),!1);var n,a,s,u,l;n=this.canvas,a=function(){return e.engine.createUnitAtPoint(e.virtualMousePosition,e.matterType,e.pointerSquareSize)},u=function(n){if("mousedown"===n.type&&n instanceof MouseEvent)0===n.button&&(s=window.setInterval(a,1));else if(n instanceof TouchEvent){var r=t(e.canvas,n);i(r),s=window.setInterval(a,1)}},l=function(){s&&window.clearInterval(s)},n.addEventListener("mousedown",u),n.addEventListener("mouseup",l),n.addEventListener("mouseout",l),n.addEventListener("touchstart",u),n.addEventListener("touchend",l),this.canvas.addEventListener("mousedown",(function(t){1===t.button&&(e.matterType<4?e.matterType+=1:e.matterType=0)}),!1),this.renderer=new o.Renderer(this.canvas),document.addEventListener("keydown",(function(t){"ArrowRight"===t.key&&e.framePositionX<e.worldSideSize-e.frameWidth&&(e.framePositionX+=1),"ArrowLeft"===t.key&&e.framePositionX>0&&(e.framePositionX-=1),"ArrowUp"===t.key&&e.framePositionY<e.worldSideSize-e.frameHeight&&(e.framePositionY+=1),"ArrowDown"===t.key&&e.framePositionY>0&&(e.framePositionY-=1)," "===t.key&&(e.isPause=!e.isPause)}))}return e.prototype.setScreenSize=function(e,t){this.renderer.setScreenSize(e,t);var i=Math.floor(e/this.renderer.getPixelSize()),n=Math.floor(t/this.renderer.getPixelSize());this.engine.setRendererSize(i,n),this.frameWidth=Math.floor(i),this.frameHeight=Math.floor(n)},e.prototype.setPixelSize=function(e){this.renderer.setPixelSize(e);var t=Math.floor(this.renderer.getScreenSizeX()/this.renderer.getPixelSize()),i=Math.floor(this.renderer.getScreenSizeY()/this.renderer.getPixelSize());console.error(t,i),this.engine.setRendererSize(t,i),this.frameWidth=t,this.frameHeight=i},e.prototype.start=function(){this.isStarted||(this.renderer.getPixels().fill(4278190080),this.isStarted=!0,this.startRender())},e.prototype.startRender=function(){var e=this,t=function(i){e.isPause||(e.renderer.setPixels(e.engine.requestFrame(e.frameWidth,e.frameHeight,e.framePositionX,e.framePositionY)),e.renderer.render(i)),window.requestAnimationFrame(t)};t(0)},e}();t.App=a},632:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(i(575)),o=n(i(199)),a=function(){function e(e){this.frameWidth=0,this.frameHeight=0,this.framePositionX=0,this.framePositionY=0,this.physicEngine=new r.default,this.worldSquareSide=2,this.mousePosition={x:0,y:0},this.lastUnitId=0,this.gameWorldState=Array.from(Array(4),(function(){return new Array(4)})),this.worldSquareSide=e,this.gameWorldState=Array.from(Array(e),(function(){return new Array(e)}))}return e.prototype.setMousedPosition=function(e){this.mousePosition=e},e.prototype.setRendererSize=function(e,t){this.frameWidth=e,this.frameHeight=t},e.prototype.extractFrame=function(e,t,i,n){for(var r,o=new Uint32Array(e*t),a=(t-1)*e,s=n;s<n+t;s+=1){for(var u=i;u<i+e;u+=1)null!==this.gameWorldState[u][s]&&(o[a]=(null===(r=this.gameWorldState[u][s])||void 0===r?void 0:r.unitState.unitColor)||0),a+=1;a-=2*e}return o},e.prototype.createUnitAtPoint=function(e,t,i){var n=this,r=function(){var e="pure-water";switch(t){case 0:e="pure-water";break;case 1:e="yellow-sand";break;case 2:e="gray-rock";break;case 3:e="flammable-gas";break;case 4:return null}return new o.default(e,null,n.lastUnitId++)};if(i>0)for(var a=Math.floor(e.x/i)*i,s=Math.floor(e.y/i)*i,u=0;u<i;u+=1)for(var l=0;l<i;l+=1){var h=r();a+l<this.worldSquareSide&&s+u<this.worldSquareSide&&(this.gameWorldState[a+l][s+u]&&null!==h||(this.gameWorldState[a+l][s+u]=h))}else{var d=r();this.gameWorldState[e.x][e.y]&&null!==d||(this.gameWorldState[e.x][e.y]=d)}},e.prototype.requestFrame=function(e,t,i,n){return this.gameWorldState=this.physicEngine.resolveWorld(this.gameWorldState,this.worldSquareSide),this.extractFrame(e,t,i,n)},e}();t.default=a},575:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(i(283)),o=function(){function e(){}return e.prototype.resolveWorld=function(e,t){for(var i,n=function(t,i,n,r,o){void 0===o&&(o=!0);var a=e[n][r];e[n][r]=e[t][i],e[n][r].isUpdated=o,e[t][i]=a},o=function(i,o){var a,s,u;(null===(a=e[i][o])||void 0===a?void 0:a.isUpdated)||((null===(s=e[i][o])||void 0===s?void 0:s.getUnitType().unitIsGas)?function(i,o){var a=i>0&&!e[i-1][o],s=i<t-1&&!e[i+1][o];if(o<=t-1){var u=!e[i][o+1],l=i>0&&!e[i-1][o+1],h=i<t-1&&!e[i+1][o+1],d=l&&h,f=a&&s;if(u)n(i,o,i,o+1);else if(d&&f){var c=(0,r.default)(0,1);n(i,o,0===c?i-1:i+1,o+1)}else l&&a?n(i,o,i-1,o+1):h&&s?n(i,o,i+1,o+1):a?n(i,o,i-1,o):s&&n(i,o,i+1,o)}else o===t-1&&(a?n(i,o,i-1,o):s&&n(i,o,i+1,o))}(i,o):(null===(u=e[i][o])||void 0===u?void 0:u.getUnitType().unitIsLiquid)?function(i,o){var a=i>0&&!e[i-1][o],s=i<t-1&&!e[i+1][o];if(o>0){var u=!e[i][o-1],l=i>0&&!e[i-1][o-1],h=i<t-1&&!e[i+1][o-1],d=l&&h,f=a&&s;if(u)n(i,o,i,o-1);else if(d&&f){var c=(0,r.default)(0,1);n(i,o,0===c?i-1:i+1,o-1)}else l&&a?n(i,o,i-1,o-1):h&&s?n(i,o,i+1,o-1):a?n(i,o,i-1,o):s&&n(i,o,i+1,o)}else 0===o&&(a?n(i,o,i-1,o):s&&n(i,o,i+1,o))}(i,o):function(i,o){var a,s,u,l,h,d,f,c,m,v,p;if(!(o<=0)){var y=!e[i][o-1]||(null===(a=e[i][o-1])||void 0===a?void 0:a.getUnitType().unitIsLiquid)||(null===(s=e[i][o-1])||void 0===s?void 0:s.getUnitType().unitIsGas),g=i>0&&(!e[i-1][o-1]||(null===(u=e[i-1][o-1])||void 0===u?void 0:u.getUnitType().unitIsLiquid)||(null===(l=e[i-1][o-1])||void 0===l?void 0:l.getUnitType().unitIsGas)),S=i<t-1&&(!e[i+1][o-1]||(null===(h=e[i+1][o-1])||void 0===h?void 0:h.getUnitType().unitIsLiquid)||(null===(d=e[i+1][o-1])||void 0===d?void 0:d.getUnitType().unitIsGas)),w=g&&S,x=i>0&&(!e[i-1][o]||(null===(f=e[i-1][o])||void 0===f?void 0:f.getUnitType().unitIsLiquid)||(null===(c=e[i-1][o])||void 0===c?void 0:c.getUnitType().unitIsGas)),P=i<t-1&&(!e[i+1][o]||(null===(m=e[i+1][o])||void 0===m?void 0:m.getUnitType().unitIsLiquid)||(null===(v=e[i+1][o])||void 0===v?void 0:v.getUnitType().unitIsGas)),z=x&&P;if(y)(null===(p=e[i][o-1])||void 0===p?void 0:p.getUnitType().unitIsLiquid)?o<t-1&&(e[i][o+1]?i>0&&!e[i-1][o]?n(i,o,i-1,o):i<t-1&&!e[i+1][o]?n(i,o,i+1,o):n(i,o,i,o-1):n(i,o,i,o-1)):e[i][o-1]||n(i,o,i,o-1);else if(w&&z){var T=(0,r.default)(0,1);n(i,o,0===T?i-1:i+1,o-1)}else g&&x?n(i,o,i-1,o-1):S&&P&&n(i,o,i+1,o-1)}}(i,o))},a=function(t,i){var n;null!=e[t][i]&&((null===(n=e[t][i])||void 0===n?void 0:n.getUnitType().unitIsStatic)||o(t,i))},s=0;s<t;s+=1)for(var u=0;u<t;u+=1)null!=e[u][s]&&((null===(i=e[u][s])||void 0===i?void 0:i.getUnitType().unitIsStatic)||(e[u][s].isUpdated=!1));for(s=0;s<t;s+=1){if(!1===Boolean((0,r.default)(0,1)))for(u=0;u<t;u+=1)a(u,s);else for(u=t-1;u>=0;u-=1)a(u,s)}return e},e}();t.default=o},648:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0;var i=function(){function e(e){var t=this;this.pixelSize=1,this.wallColor=4278190080,this.lastFrameTime=(new Date).getTime(),this.getScreenSizeX=function(){return t.width},this.getScreenSizeY=function(){return t.height},this.getPixelsCount=function(){return t.width*t.height/Math.pow(t.pixelSize,2)},this.getPixelSize=function(){return t.pixelSize},this.getLastFrameTime=function(){return t.lastFrameTime},this.canvas=e,this.width=this.canvas.width,this.height=this.canvas.height,this.desiredWidth=this.canvas.width,this.desiredHeight=this.canvas.height,this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))}return e.prototype.setScreenSize=function(e,t){this.desiredWidth=e,this.desiredHeight=t,this.width=Math.floor(e/this.pixelSize)*this.pixelSize,this.height=Math.floor(t/this.pixelSize)*this.pixelSize,this.canvas.width=this.width,this.canvas.height=this.height,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))},e.prototype.setPixelSize=function(e){this.pixelSize=e,this.setScreenSize(this.desiredWidth,this.desiredHeight)},e.prototype.render=function(e){for(var t=function(e,t,i,n){return(n-t-1)*i+e},i=0;i<this.height/this.pixelSize;i++)for(var n=0;n<this.width/this.pixelSize;n++)for(var r=0;r<this.pixelSize;r++)for(var o=0;o<this.pixelSize;o++){var a=t(n*this.pixelSize+r,i*this.pixelSize+o,this.width,this.height),s=t(n,i,this.width/this.pixelSize,this.height/this.pixelSize);this.realPixels[a]=this.virtualPixels[s]}this.ctx.putImageData(this.imageData,0,0),1e3/(performance.now()-this.lastFrameTime)==1/0&&(this.lastFrameTime=performance.now()),this.ctx.font="10px serif",this.ctx.fillStyle="red",this.ctx.fillText("FPS: ".concat(String(1e3/(performance.now()-this.lastFrameTime))),0,10),this.lastFrameTime=performance.now()},e.prototype.getPixels=function(){return this.virtualPixels},e.prototype.setPixels=function(e){this.virtualPixels=e},e}();t.Renderer=i},199:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=i(281),o=n(i(283)),a=function(){function e(e,t,i,n){if(void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=null),this.isUpdated=!1,this.unitTypeName=e,this.unitVelocityVector=t,this.unitId=i,n)this.unitState=n;else{var a=(0,r.getUnitTypeByUnitTypeName)(e),s=a.unitDefaultColor,u=(0,o.default)(s.minRandomColor,s.maxRandomColor),l=u+u*Math.pow(16,2)+u*Math.pow(16,4),h=s.baseColor+l;this.unitState={unitHealth:a.unitDefaultHealth,unitIsOnFire:!1,unitColor:h}}}return e.prototype.getUnitType=function(){return(0,r.getUnitTypeByUnitTypeName)(this.unitTypeName)},e}();t.default=a},281:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getUnitTypeByUnitTypeName=t.UnitTypesArray=t.UnitTypesStringsToIndex=void 0,t.UnitTypesStringsToIndex={"yellow-sand":0,"pure-water":1,"gray-rock":2,"flammable-gas":3},t.UnitTypesArray=[{unitName:"yellow-sand",unitIsLiquid:!1,unitIsStatic:!1,unitIsGas:!1,unitIsFlammable:!1,unitDefaultHealth:10,unitDefaultColor:{minRandomColor:10,maxRandomColor:53,baseColor:4278241994},unitTransformations:{toFreeze:"yellow-sand",toLiquid:"molten-glass",toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"pure-water",unitIsLiquid:!0,unitIsStatic:!1,unitIsGas:!1,unitIsFlammable:!1,unitDefaultHealth:10,unitDefaultColor:{minRandomColor:0,maxRandomColor:0,baseColor:2013255936},unitTransformations:{toFreeze:"pure-ice",toLiquid:"pure-water",toVapor:"water-steam",toDestroy:"water-steam",toCorrode:"water-steam"}},{unitName:"gray-rock",unitIsLiquid:!1,unitIsStatic:!0,unitIsGas:!1,unitIsFlammable:!1,unitDefaultHealth:100,unitDefaultColor:{minRandomColor:10,maxRandomColor:82,baseColor:4286677377},unitTransformations:{toFreeze:null,toLiquid:"molten-rock",toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"flammable-gas",unitIsLiquid:!1,unitIsStatic:!1,unitIsGas:!0,unitIsFlammable:!1,unitDefaultHealth:10,unitDefaultColor:{minRandomColor:10,maxRandomColor:82,baseColor:856795648},unitTransformations:{toFreeze:null,toLiquid:"flammable-liquid",toVapor:null,toDestroy:null,toCorrode:null}}];t.getUnitTypeByUnitTypeName=function(e){var i=t.UnitTypesStringsToIndex[e];return t.UnitTypesArray[i]}},283:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){var i=Math.ceil(e),n=Math.floor(t);return Math.floor(Math.random()*(n-i+1))+i}}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};!function(){i(213);var e=new(i(844).App);e.setScreenSize(1e3,1e3),e.setPixelSize(6),e.start()}()}();