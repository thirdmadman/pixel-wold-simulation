!function(){"use strict";var t={213:function(t,i,e){e.r(i)},844:function(t,i,e){var n=this&&this.__spreadArray||function(t,i,e){if(e||2===arguments.length)for(var n,o=0,r=i.length;o<r;o++)!n&&o in i||(n||(n=Array.prototype.slice.call(i,0,o)),n[o]=i[o]);return t.concat(n||Array.prototype.slice.call(i))};Object.defineProperty(i,"__esModule",{value:!0}),i.App=void 0;var o=e(659),r=e(748),a=e(273),s=function(){function t(){var t=this;this.worldSideSize=500,this.engine=new r.Engine(this.worldSideSize),this.canvas=document.createElement("canvas"),this.isStarted=!1,this.frameHeight=10,this.frameWidth=10,this.framePositionX=0,this.framePositionY=0,this.realMousePosition={x:0,y:0},this.virtualMousePosition={x:0,y:0},this.isPause=!1,this.dataStorage=new o.DataStorage,this.canvas.classList.add("canvas-renderer");var i=document.body.querySelector(".app");i&&i.appendChild(this.canvas);var e=function(i){t.realMousePosition=i;var e=t.renderer.getPixelSize();t.virtualMousePosition.x=t.framePositionX+Math.floor(i.x/e),t.virtualMousePosition.y=t.framePositionY+(t.frameHeight-1-Math.floor(i.y/e)),t.engine.setMousedPosition(t.virtualMousePosition)};this.canvas.addEventListener("mousemove",(function(i){var n=function(t,i){var e=t.getBoundingClientRect(),n=t.width/e.width,o=t.height/e.height;return{x:(i.clientX-e.left)*n,y:(i.clientY-e.top)*o}}(t.canvas,i);e(n)}),!1),this.canvas.addEventListener("touchmove",(function(i){var n=function(t,i){var e=t.getBoundingClientRect(),n=i.touches[0],o=t.width/e.width,r=t.height/e.height;return{x:(n.clientX-e.left)*o,y:(n.clientY-e.top)*r}}(t.canvas,i);e(n)}),!1),this.canvas.addEventListener("wheel",(function(i){-i.deltaY<0?t.engine.handleMouseWheelDown():-i.deltaY>0&&t.engine.handleMouseWheelUp()}),!1),this.canvas.addEventListener("mousedown",(function(i){if(0===i.button)t.engine.handleMouseLeftButtonDown(t.virtualMousePosition);else console.error(i.button)}),!1),this.canvas.addEventListener("mouseup",(function(i){if(0===i.button)t.engine.handleMouseLeftButtonUp(t.virtualMousePosition);else console.error(i.button)}),!1),document.addEventListener("keydown",(function(i){if("ArrowRight"===i.key&&t.framePositionX<t.worldSideSize-t.frameWidth&&(t.framePositionX+=1,t.engine.setFramePosition(t.framePositionX,t.framePositionY)),"ArrowLeft"===i.key&&t.framePositionX>0&&(t.framePositionX-=1,t.engine.setFramePosition(t.framePositionX,t.framePositionY)),"ArrowUp"===i.key&&t.framePositionY<t.worldSideSize-t.frameHeight&&(t.framePositionY+=1,t.engine.setFramePosition(t.framePositionX,t.framePositionY)),"ArrowDown"===i.key&&t.framePositionY>0&&(t.framePositionY-=1,t.engine.setFramePosition(t.framePositionX,t.framePositionY)),"Escape"===i.key&&(t.isPause=!t.isPause,t.engine.setPause(t.isPause)),"s"===i.key){var e=t.engine.getEngineState();t.dataStorage.saveToLocalStorage(e)}if("l"===i.key){e=t.dataStorage.loadFromLocalStorage();t.engine.setEngineState(e)}})),this.renderer=new a.Renderer(this.canvas)}return t.prototype.setScreenSize=function(t,i){this.renderer.setScreenSize(t,i);var e=Math.floor(t/this.renderer.getPixelSize()),n=Math.floor(i/this.renderer.getPixelSize());this.engine.setRendererSize(e,n),this.frameWidth=Math.floor(e),this.frameHeight=Math.floor(n)},t.prototype.setPixelSize=function(t){this.renderer.setPixelSize(t);var i=Math.floor(this.renderer.getScreenSizeX()/this.renderer.getPixelSize()),e=Math.floor(this.renderer.getScreenSizeY()/this.renderer.getPixelSize());console.error(i,e),this.engine.setRendererSize(i,e),this.frameWidth=i,this.frameHeight=e},t.prototype.start=function(){this.isStarted||(this.isStarted=!0,this.startRender())},t.prototype.startRender=function(){var t=this,i=this.renderer.getPixels();this.renderer.setPixels(i.fill(4278190080));var e=function(i){var o=t.engine.requestFrame(t.frameWidth,t.frameHeight,t.framePositionX,t.framePositionY),r={x:0,y:0,width:2,height:3,pixels:new Uint32Array(6)};r.pixels[0]=4294901760,r.pixels[1]=4294901760,r.pixels[2]=4278255360,r.pixels[3]=4278255360,r.pixels[4]=4278190335,r.pixels[5]=4278190335;var a={x:0,y:0,width:t.frameWidth,height:t.frameHeight,pixels:o},s=t.engine.getUi().getLayers(),l=t.renderer.blendPixelLayers(n(n([a],s,!0),[r],!1),t.renderer.getScreenSizeX()/t.renderer.getPixelSize(),t.renderer.getScreenSizeY()/t.renderer.getPixelSize());null!==l&&t.renderer.setPixels(l),t.renderer.render(i),window.requestAnimationFrame(e)};e(0)},t}();i.App=s},987:function(t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getUnitTypeByUnitTypeName=i.UnitTypesArray=i.UnitTypesStringsToIndex=void 0,i.UnitTypesStringsToIndex={"yellow-sand":0,"pure-water":1,"gray-rock":2,"flammable-gas":3,"red-blood":4,"yellow-flame":5,"gray-smoke":6,"black-oil":7,"rock-hard":8,"wood-wall":9},i.UnitTypesArray=[{unitName:"yellow-sand",unitIsLiquid:!1,unitIsStatic:!1,unitIsGas:!1,unitIsFlammable:!1,unitDefaultFlameSustainability:1,unitDefaultFireHP:0,unitDefaultHealth:800,unitDurability:4,unitDensity:1.5,unitDefaultColor:{minRandomColor:0,maxRandomColor:20,colorShiftNumbers:4095,baseColor:4278242795},unitTransformations:{toFreeze:"yellow-sand",toLiquid:"molten-glass",toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"pure-water",unitIsLiquid:!0,unitIsStatic:!1,unitIsGas:!1,unitIsFlammable:!1,unitDefaultFlameSustainability:1,unitDefaultFireHP:0,unitDefaultHealth:10,unitDurability:0,unitDensity:1,unitDefaultColor:{minRandomColor:0,maxRandomColor:0,colorShiftNumbers:4095,baseColor:2013255936},unitTransformations:{toFreeze:"pure-ice",toLiquid:"pure-water",toVapor:"water-steam",toDestroy:"water-steam",toCorrode:"water-steam"}},{unitName:"gray-rock",unitIsLiquid:!1,unitIsStatic:!0,unitIsGas:!1,unitIsFlammable:!1,unitDefaultFlameSustainability:3,unitDefaultFireHP:0,unitDefaultHealth:100,unitDurability:0,unitDensity:2.6,unitDefaultColor:{minRandomColor:10,maxRandomColor:82,colorShiftNumbers:4095,baseColor:4286677377},unitTransformations:{toFreeze:null,toLiquid:"molten-rock",toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"flammable-gas",unitIsLiquid:!1,unitIsStatic:!1,unitIsGas:!0,unitIsFlammable:!0,unitDefaultFlameSustainability:600,unitDefaultFireHP:10,unitDefaultHealth:10,unitDurability:0,unitDensity:.00182,unitDefaultColor:{minRandomColor:10,maxRandomColor:82,colorShiftNumbers:4095,baseColor:856795648},unitTransformations:{toFreeze:null,toLiquid:"flammable-liquid",toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"red-blood",unitIsLiquid:!0,unitIsStatic:!1,unitIsGas:!1,unitIsFlammable:!1,unitDefaultFlameSustainability:1,unitDefaultFireHP:0,unitDefaultHealth:10,unitDurability:0,unitDensity:1.03,unitDefaultColor:{minRandomColor:0,maxRandomColor:0,colorShiftNumbers:4095,baseColor:2852257923},unitTransformations:{toFreeze:"frozen-red-blood",toLiquid:null,toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"yellow-flame",unitIsLiquid:!1,unitIsStatic:!1,unitIsGas:!1,unitIsFlame:!0,unitIsFlammable:!1,unitDefaultFlameSustainability:1,unitDefaultFireHP:1,unitDefaultHealth:3,unitDurability:0,unitDensity:33e-5,unitDefaultColor:{minRandomColor:0,maxRandomColor:0,colorShiftNumbers:0,baseColor:4278214911},unitTransformations:{toFreeze:null,toLiquid:null,toVapor:null,toDestroy:"gray-smoke",toCorrode:null}},{unitName:"gray-smoke",unitIsLiquid:!1,unitIsStatic:!1,unitIsGas:!0,unitIsFlammable:!1,unitDefaultFlameSustainability:1,unitDefaultFireHP:0,unitDefaultHealth:100,unitDurability:0,unitDensity:61e-5,unitDefaultColor:{minRandomColor:10,maxRandomColor:16,colorShiftNumbers:4095,baseColor:2004976001},unitTransformations:{toFreeze:null,toLiquid:null,toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"black-oil",unitIsLiquid:!0,unitIsStatic:!1,unitIsGas:!1,unitIsFlammable:!0,unitDefaultFlameSustainability:995,unitDefaultFireHP:500,unitDefaultHealth:1e3,unitDurability:0,unitDensity:.88,unitDefaultColor:{minRandomColor:0,maxRandomColor:20,colorShiftNumbers:15,baseColor:4278190080},unitTransformations:{toFreeze:null,toLiquid:null,toVapor:null,toDestroy:"gray-smoke",toCorrode:null}},{unitName:"rock-hard",unitIsLiquid:!1,unitIsStatic:!0,unitIsGas:!1,unitIsFlammable:!1,unitDefaultFlameSustainability:0,unitDefaultFireHP:0,unitDefaultHealth:2e5,unitDurability:12,unitDensity:.88,unitDefaultColor:{minRandomColor:0,maxRandomColor:20,colorShiftNumbers:4095,baseColor:4280492926},unitTransformations:{toFreeze:null,toLiquid:null,toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"wood-wall",unitIsLiquid:!1,unitIsStatic:!0,unitIsGas:!1,unitIsFlammable:!0,unitDefaultFlameSustainability:992,unitDefaultFireHP:600,unitDefaultHealth:2e3,unitDurability:10,unitDensity:.88,unitDefaultColor:{minRandomColor:0,maxRandomColor:20,colorShiftNumbers:15,baseColor:4279859366},unitTransformations:{toFreeze:null,toLiquid:null,toVapor:null,toDestroy:null,toCorrode:null}}];i.getUnitTypeByUnitTypeName=function(t){var e=i.UnitTypesStringsToIndex[t];return i.UnitTypesArray[e]}},659:function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.DataStorage=void 0;var n=e(900),o=function(){function t(){}return t.prototype.convertWorldStateToSave=function(t){for(var i,e=t.gameWorldState,n=t.worldSquareSide,o={},r=0;r<n;r+=1)for(var a=0;a<n;a+=1)null!=e[r][a]&&(o[r]||(o[r]={}),o[r][a]=null===(i=e[r][a])||void 0===i?void 0:i.toJson());return o},t.prototype.serializeToSaveFile=function(t){var i={frameWidth:t.frameWidth,frameHeight:t.frameHeight,framePositionX:t.framePositionX,framePositionY:t.framePositionY,worldSideSize:t.worldSquareSide,lastUnitId:t.lastUnitId,worldSate:this.convertWorldStateToSave(t)};return console.error(i),JSON.stringify(i)},t.prototype.convertSaveToWorldState=function(t,i){for(var e=new Array(i),o=new Array(i),r=0;r<i;r++)o[r]=null;for(r=0;r<e.length;r++)e[r]=o.slice(0);var a=e;return Object.keys(t).forEach((function(i){t[parseInt(i,10)]&&Object.keys(t[parseInt(i,10)]).forEach((function(e){if(t[parseInt(i,10)][parseInt(e,10)]){var o=t[parseInt(i,10)][parseInt(e,10)],r={unitHealth:o.s.h,unitIsOnFire:Boolean(o.s.f),unitColor:o.s.c,unitDecalColor:o.s.d,flameSustainability:o.s.s,fireHP:o.s.j},s=o.v?{startPoint:o.v.s,endPoint:o.v.e}:null,l=new n.Unit(o.n,s,o.i,r);a[parseInt(i,10)][parseInt(e,10)]=l}}))})),a},t.prototype.deserializeAnLoadFromFile=function(t){var i=JSON.parse(t);if(t&&"{"===t[0]){var e=Object.keys(i).length;if(i&&e>0&&i.worldSate)return{frameWidth:i.frameWidth,frameHeight:i.frameHeight,framePositionX:i.framePositionX,framePositionY:i.framePositionY,worldSquareSide:i.worldSideSize,lastUnitId:i.lastUnitId,gameWorldState:this.convertSaveToWorldState(i.worldSate,i.worldSideSize)}}return null},t.prototype.saveToLocalStorage=function(t){localStorage.setItem("pws-save",this.serializeToSaveFile(t))},t.prototype.loadFromLocalStorage=function(){var t=localStorage.getItem("pws-save");return t?this.deserializeAnLoadFromFile(t):null},t}();i.DataStorage=o},748:function(t,i,e){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t},n.apply(this,arguments)};Object.defineProperty(i,"__esModule",{value:!0}),i.Engine=void 0;var o=e(507),r=e(382),a=e(900),s=e(527),l=function(){function t(t,i){void 0===i&&(i=null);var e=this;if(this.frameWidth=0,this.frameHeight=0,this.framePositionX=0,this.framePositionY=0,this.physicEngine=new o.PhysicEngine,this.worldSquareSide=2,this.mousePosition={x:0,y:0},this.lastMousePosition={x:0,y:0},this.lastUnitId=0,this.isPhysicsEnginePause=!1,this.unitCreationType=0,this.unitCreationSquareSize=0,this.gameMaxCountMaterials=9,this.ui=new r.UI({}),this.eventsStack=[],this.gameWorldState=Array.from(Array(4),(function(){return new Array(4)})),i)this.setEngineState(i);else{this.worldSquareSide=t;for(var n=new Array(t),a=new Array(t),s=0;s<t;s++)a[s]=null;for(s=0;s<n.length;s++)n[s]=a.slice(0);this.gameWorldState=n}var l={"switch-create-pure-water":function(){e.unitCreationType=0},"switch-create-yellow-sand":function(){e.unitCreationType=1},"switch-create-gray-rock":function(){e.unitCreationType=2},"switch-create-flammable-gas":function(){e.unitCreationType=3},"switch-create-red-blood":function(){e.unitCreationType=4},"switch-create-black-oil":function(){e.unitCreationType=6},"switch-create-rock-hard":function(){e.unitCreationType=8},"switch-create-wood-wall":function(){e.unitCreationType=9},"switch-remove":function(){e.unitCreationType=5},"switch-ignite":function(){e.unitCreationType=7},"default-action":function(t){return e.mainAction(t)}};this.ui=new r.UI(l)}return t.prototype.setEngineState=function(t){t&&(this.frameWidth=t.frameWidth,this.frameHeight=t.frameHeight,this.framePositionX=t.framePositionX,this.framePositionY=t.framePositionY,this.worldSquareSide=t.worldSquareSide,this.mousePosition=t.mousePosition,this.lastMousePosition=t.lastMousePosition,this.lastUnitId=0,this.gameWorldState=t.gameWorldState)},t.prototype.getEngineState=function(){return{frameWidth:this.frameHeight,frameHeight:this.frameHeight,framePositionX:this.framePositionX,framePositionY:this.framePositionY,worldSquareSide:this.worldSquareSide,mousePosition:this.mousePosition,lastMousePosition:this.lastMousePosition,lastUnitId:this.lastUnitId,gameWorldState:this.gameWorldState}},t.prototype.setPause=function(t){this.isPhysicsEnginePause=t},t.prototype.setFramePosition=function(t,i){this.framePositionX=t,this.framePositionY=i,this.ui.setFramePosition({x:t,y:i})},t.prototype.setMousedPosition=function(t){this.lastMousePosition=this.mousePosition,this.mousePosition=t,this.ui.setMousePosition(t)},t.prototype.setRendererSize=function(t,i){this.frameWidth=t,this.frameHeight=i,this.ui.setRendererSize(t,i)},t.prototype.getUi=function(){return this.ui},t.prototype.extractFrame=function(t,i,e,n){var o,r;(o=this.eventsStack).push.apply(o,this.ui.collectActions()),this.eventsStack.forEach((function(t){return t()})),this.eventsStack=[];for(var a=new Uint32Array(t*i),l=(i-1)*t,u=n;u<n+i;u+=1){for(var h=e;h<e+t;h+=1){if(null!==this.gameWorldState[h][u]){var d=null;if(null!==this.gameWorldState[h][u]&&(null===(r=this.gameWorldState[h][u])||void 0===r?void 0:r.unitState)){var f=this.gameWorldState[h][u].unitState.unitColor,c=this.gameWorldState[h][u].unitState.unitDecalColor;d=c&&0!==c?Number((0,s.mixColors)(f,c)):f}d&&(a[l]=d)}l+=1}l-=2*t}return a},t.prototype.handleMouseLeftButtonDown=function(t){this.ui.handleClickDown(t),this.lastMousePosition=this.mousePosition,this.mousePosition=t},t.prototype.handleMouseLeftButtonUp=function(t){this.ui.handleClickUp(t),this.lastMousePosition=this.mousePosition,this.mousePosition=t},t.prototype.mainAction=function(t){var i=this;this.drawLine(this.lastMousePosition,t,(function(t){return i.createUnitAtPoint(t,i.unitCreationType,i.unitCreationSquareSize)}))},t.prototype.drawLine=function(t,i,e){void 0===e&&(e=function(){});var n=[],o=t.x,r=t.y,a=i.x,s=i.y,l=Math.abs(a-o),u=Math.abs(s-r),h=o<a?1:-1,d=r<s?1:-1,f=l-u;do{e({x:o,y:r}),n.push({x:o,y:r});var c=2*f;c>-u&&(f-=u,o+=h),c<l&&(f+=l,r+=d)}while(o!==a||r!==s);return n},t.prototype.handleMouseWheelUp=function(){this.unitCreationSquareSize<2*this.frameHeight&&(this.unitCreationSquareSize+=1)},t.prototype.handleMouseWheelDown=function(){this.unitCreationSquareSize>0&&(this.unitCreationSquareSize-=1)},t.prototype.handleMouseMiddleButton=function(){this.unitCreationType<this.gameMaxCountMaterials?this.unitCreationType+=1:this.unitCreationType=0},t.prototype.createUnit=function(t,i,e){this.lastUnitId+=1;var o=new a.Unit(t,i,this.lastUnitId);if(e){var r=n(n({},o.unitState),e);o.unitState=r}return o},t.prototype.createUnitAtPoint=function(t,i,e){var n,o,r=function(){var t="pure-water";switch(i){case 0:t="pure-water";break;case 1:t="yellow-sand";break;case 2:t="gray-rock";break;case 3:t="flammable-gas";break;case 4:t="red-blood";break;case 5:return null;case 6:t="black-oil";break;case 7:return"set-on-fire";case 8:t="rock-hard";break;case 9:t="wood-wall"}return new a.Unit(t,null,0)};if(e>0)for(var s=Math.floor(t.x/e)*e,l=Math.floor(t.y/e)*e,u=0;u<e;u+=1)for(var h=0;h<e;h+=1){var d=r();s+h<this.worldSquareSide&&l+u<this.worldSquareSide&&("set-on-fire"===d?this.gameWorldState[s+h][l+u]&&(null===(n=this.gameWorldState[s+h][l+u])||void 0===n?void 0:n.getUnitType().unitIsFlammable)&&(this.gameWorldState[s+h][l+u].unitState.unitIsOnFire=!0):this.gameWorldState[s+h][l+u]&&null!==d||(this.gameWorldState[s+h][l+u]=d,null!==d&&(d.unitId=this.lastUnitId++)))}else{var f=r();"set-on-fire"===f?this.gameWorldState[t.x][t.y]&&(null===(o=this.gameWorldState[t.x][t.y])||void 0===o?void 0:o.getUnitType().unitIsFlammable)&&(this.gameWorldState[t.x][t.y].unitState.unitIsOnFire=!0):this.gameWorldState[t.x][t.y]&&null!==f||(this.gameWorldState[t.x][t.y]=f,null!==f&&(f.unitId=this.lastUnitId++))}},t.prototype.requestFrame=function(t,i,e,n){var o=this;return this.isPhysicsEnginePause||(this.gameWorldState=this.physicEngine.resolveWorld(this.gameWorldState,this.worldSquareSide,(function(t,i,e){return o.createUnit(t,i,e)}))),this.extractFrame(t,i,e,n)},t}();i.Engine=l},507:function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.PhysicEngine=void 0;var n=e(527),o=function(){function t(){this.lastY=0,this.isLineByLineResolve=!1,this.lastUnitId=0,this.emittedUnits=[]}return t.prototype.resolveWorld=function(t,i,e){for(var o,r=this,a=function(i,e,n,o,r){void 0===r&&(r=!0);var a=t[n][o];t[n][o]=t[i][e],t[n][o]&&(t[n][o].isUpdated=r),t[i][e]=a,t[i][e]&&(t[i][e].isUpdated=r)},s=function(e,n,o,r,s){if(void 0===s&&(s=!0),t[o][r]){var l=function(e,n,o){var r=function(o){return t[e][n+o]?e>0&&!t[e-1][n+o]?(a(e,n,e-1,n+o),!0):e<i-1&&!t[e+1][n+o]&&(a(e,n,e+1,n+o),!0):(a(e,n,e,n+o),!0)},s=o?-1:1;if(n>=0){if(r(1*s))return!0}else{if(e>0&&!t[e-1][n])return a(e,n,e-1,n),!0;if(e<i-1&&!t[e+1][n])return a(e,n,e+1,n),!0;if(n<i-1&&r(-1*s))return!0}return!1}(o,r,t[o][r].getUnitType().unitIsLiquid);l||a(e,n,o,r,s)}else a(e,n,o,r,s)},l=function(e,o){var r,a;(function(t,e){return t>=0&&t<i&&e>=0&&e<i})(e,o)&&(t[e][o]&&(null===(r=t[e][o])||void 0===r?void 0:r.getUnitType().unitIsFlammable)&&(t[e][o].unitState.unitIsOnFire||(0,n.getRandomInt)(0,1e3)>=((null===(a=t[e][o])||void 0===a?void 0:a.getUnitType().unitDefaultFlameSustainability)||0)&&(t[e][o].unitState.unitIsOnFire=!0)))},u=function(e,n){var o;if(n+1>i)return!1;if(!t[e][n+1])return Math.random()>=.1&&(t[e][n].unitState.unitHealth-=1),a(e,n,e,n+1),!0;if((null===(o=t[e][n+1])||void 0===o?void 0:o.getUnitType().unitIsFlame)&&u(e,n+1))return Math.random()>=.5&&(t[e][n].unitState.unitHealth-=1),a(e,n,e,n+1),!0;return!1},h=function(e,o){var r,l,h,d;(null===(r=t[e][o])||void 0===r?void 0:r.isUpdated)||((null===(l=t[e][o])||void 0===l?void 0:l.getUnitType().unitIsGas)?function(e,o){var r,s,l,u,h,d=e>0&&!t[e-1][o],f=e<i-1&&!t[e+1][o];if(o<=i-1){var c=!t[e][o+1],y=e>0&&!t[e-1][o+1],m=e<i-1&&!t[e+1][o+1],p=y&&m,v=d&&f;if("gray-smoke"===(null===(r=t[e][o])||void 0===r?void 0:r.unitTypeName)&&(null===(s=t[e][o+1])||void 0===s?void 0:s.getUnitType().unitIsStatic)&&(0,n.getRandomInt)(0,(null===(l=t[e][o])||void 0===l?void 0:l.getUnitType().unitDefaultHealth)||1)>=((null===(h=null===(u=t[e][o])||void 0===u?void 0:u.unitState)||void 0===h?void 0:h.unitHealth)||1)&&(t[e][o].unitState.unitHealth-=1),c)a(e,o,e,o+1);else if(p&&v){var g=(0,n.getRandomInt)(0,1);a(e,o,0===g?e-1:e+1,o+1)}else y&&d?a(e,o,e-1,o+1):m&&f?a(e,o,e+1,o+1):d?a(e,o,e-1,o):f&&a(e,o,e+1,o)}else o===i-1&&(d?a(e,o,e-1,o):f&&a(e,o,e+1,o))}(e,o):(null===(h=t[e][o])||void 0===h?void 0:h.getUnitType().unitIsLiquid)?function(e,o){var r,s,l,u,h,d,f,c,y,m,p=e>0&&!t[e-1][o],v=e>0&&!p&&!p&&(null===(r=t[e-1][o])||void 0===r?void 0:r.isUpdated),g=e>0&&!p&&(null===(s=t[e-1][o])||void 0===s?void 0:s.getUnitType().unitIsLiquid)&&t[e-1][o].getUnitType().unitDensity<t[e][o].getUnitType().unitDensity,S=e>0&&!p&&(null===(l=t[e-1][o])||void 0===l?void 0:l.getUnitType().unitIsGas),P=e<i-1&&!t[e+1][o],w=e<i-1&&!P&&(null===(u=t[e+1][o])||void 0===u?void 0:u.isUpdated),x=e<i-1&&!P&&(null===(h=t[e+1][o])||void 0===h?void 0:h.getUnitType().unitIsLiquid)&&t[e+1][o].getUnitType().unitDensity<t[e][o].getUnitType().unitDensity,T=e<i-1&&!P&&(null===(d=t[e+1][o])||void 0===d?void 0:d.getUnitType().unitIsGas);if(o>0){var I=!t[e][o-1],U=!I&&(null===(f=t[e][o-1])||void 0===f?void 0:f.getUnitType().unitIsLiquid)&&t[e][o-1].getUnitType().unitDensity<t[e][o].getUnitType().unitDensity,b=!I&&(null===(c=t[e][o-1])||void 0===c?void 0:c.getUnitType().unitIsGas),D=e>0&&!t[e-1][o-1],C=e>0&&!D&&t[e-1][o-1].getUnitType().unitIsLiquid&&t[e-1][o-1].getUnitType().unitDensity<t[e][o].getUnitType().unitDensity,M=e>0&&!D&&t[e-1][o-1].getUnitType().unitIsGas,F=e>0&&!D&&(null===(y=t[e-1][o-1])||void 0===y?void 0:y.isUpdated),L=e<i-1&&!t[e+1][o-1],z=e<i-1&&!L&&t[e+1][o-1].getUnitType().unitIsLiquid&&t[e+1][o-1].getUnitType().unitDensity<t[e][o].getUnitType().unitDensity,H=e<i-1&&!L&&t[e+1][o-1].getUnitType().unitIsGas,N=e<i-1&&!L&&(null===(m=t[e+1][o-1])||void 0===m?void 0:m.isUpdated),k=D&&L,W=C&&z,q=M&&H,R=p&&P,A=v&&w,B=g&&x,Y=S&&T;if(I||U||b)a(e,o,e,o-1);else if(!A&&(k||W||q)&&(R||B||Y)){var O=(0,n.getRandomInt)(0,1);a(e,o,0===O?e-1:e+1,o-1)}else!F&&(D||C||M)&&(p||g||S)?a(e,o,e-1,o-1):!N&&(L||z||H)&&(P||x||T)?a(e,o,e+1,o-1):!v&&(p||g||S)?a(e,o,e-1,o):!w&&(P||x||T)&&a(e,o,e+1,o)}else 0===o&&(!v&&(p||g||S)?a(e,o,e-1,o):!w&&(P||x||T)&&a(e,o,e+1,o))}(e,o):(null===(d=t[e][o])||void 0===d?void 0:d.getUnitType().unitIsFlame)?function(i,e){Math.random()>=.8&&(t[i][e].unitState.unitHealth-=1),u(i,e)}(e,o):function(e,o){var r,l,u,h,d,f,c,y,m,p;if(!(o<=0)){var v=!1,g=!1,S=!1,P=!1,w=!1,x=!1,T=!1,I=!1,U=!1,b=!1,D=!1,C=!1;e>0&&((v=!t[e-1][o])||(g=!!(null===(r=t[e-1][o])||void 0===r?void 0:r.getUnitType().unitIsLiquid),S=!!(null===(l=t[e-1][o])||void 0===l?void 0:l.getUnitType().unitIsGas)),(T=!t[e-1][o-1])||(I=!!(null===(u=t[e-1][o-1])||void 0===u?void 0:u.getUnitType().unitIsLiquid),U=!!(null===(h=t[e-1][o-1])||void 0===h?void 0:h.getUnitType().unitIsGas))),e<i-1&&((P=!t[e+1][o])||(w=!!(null===(d=t[e+1][o])||void 0===d?void 0:d.getUnitType().unitIsLiquid),x=!!(null===(f=t[e+1][o])||void 0===f?void 0:f.getUnitType().unitIsGas)),(b=!t[e+1][o-1])||(D=!!(null===(c=t[e+1][o-1])||void 0===c?void 0:c.getUnitType().unitIsLiquid),C=!!(null===(y=t[e+1][o-1])||void 0===y?void 0:y.getUnitType().unitIsGas)));var M=t[e][o-1]&&((null===(m=t[e][o-1])||void 0===m?void 0:m.getUnitType().unitIsLiquid)||(null===(p=t[e][o-1])||void 0===p?void 0:p.getUnitType().unitIsGas)),F=v||g||S,L=P||w||x,z=T||I||U,H=b||D||C,N=z&&H,k=F&&L;if(!t[e][o-1]||M)M?o<i-1&&s(e,o,e,o-1):t[e][o-1]||a(e,o,e,o-1);else if(N&&k){var W=(0,n.getRandomInt)(0,1);s(e,o,0===W?e-1:e+1,o-1)}else z&&F?s(e,o,e-1,o-1):H&&L&&s(e,o,e+1,o-1)}}(e,o))},d=function(i,e){var o,a,s,u,d,f,c;if(null!=t[i][e]){if(t[i][e]&&(null===(o=t[i][e])||void 0===o?void 0:o.unitState)&&t[i][e].unitState.unitHealth<=0){var y=null===(a=t[i][e])||void 0===a?void 0:a.getUnitType().unitTransformations;if(t[i][e]=null,!y||!y.toDestroy)return;return void(Math.random()>=.99&&r.emittedUnits.push({unitType:y.toDestroy,x:i,y:e}))}if(t[i][e]&&(null===(s=t[i][e])||void 0===s?void 0:s.getUnitType().unitIsFlammable)&&(null===(u=t[i][e])||void 0===u?void 0:u.unitState)&&t[i][e].unitState.fireHP<=0){if(t[i][e]=null,!(y=null===(d=t[i][e])||void 0===d?void 0:d.getUnitType().unitTransformations)||!y.toDestroy)return;return void r.emittedUnits.push({unitType:y.toDestroy,x:i,y:e})}(null===(f=t[i][e])||void 0===f?void 0:f.unitState.unitIsOnFire)&&(!function(i,e){var o=0;(0,n.getRandomInt)(0,100)>=30&&(o=4278190335+(0,n.getRandomInt)(0,233)*Math.pow(16,2)),t[i][e].unitState.unitDecalColor=o,t[i][e].unitState.fireHP-=1,l(i-1,e),l(i+1,e),l(i,e+1),l(i,e-1)}(i,e),r.emittedUnits.push({unitType:"yellow-flame",x:i,y:e+1})),(null===(c=t[i][e])||void 0===c?void 0:c.getUnitType().unitIsStatic)||h(i,e)}},f=0;f<i;f+=1)for(var c=0;c<i;c+=1)null!=t[c][f]&&((null===(o=t[c][f])||void 0===o?void 0:o.getUnitType().unitIsStatic)||(t[c][f].isUpdated=!1));var y=function(t){if(!1===Boolean((0,n.getRandomInt)(0,1)))for(var e=0;e<i;e+=1)d(e,t);else for(e=i-1;e>=0;e-=1)d(e,t)};if(this.isLineByLineResolve){f=0;this.lastY<i?f=this.lastY++:this.lastY=0,y(f)}else for(f=0;f<i;f+=1)y(f);for(var m=0;m<this.emittedUnits.length;m+=1){var p=this.emittedUnits[m],v=(c=p.x,f=p.y,p.unitType);null===t[c][f]&&(t[c][f]=e(v,null,null))}return this.emittedUnits=[],t},t}();i.PhysicEngine=o},382:function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.UI=void 0;var n=e(987),o=e(527),r=function(){function t(t){this.frameWidth=1,this.frameHeight=1,this.mousePosition={x:0,y:0},this.mouseUIPosition={x:0,y:0},this.framePosition={x:0,y:0},this.actions={},this.isMouseDown=!1,this.eventsStack=[],this.layers=[],this.actions=t,this.initLayers()}return t.prototype.getCursorPixels=function(){var t=new Uint32Array(9);return t[1]=4278190080,t[3]=4278190080,t[5]=4278190080,t[7]=4278190080,t},t.prototype.initLayers=function(){this.layers.push({pixelsLayer:{width:4,height:80,x:4,y:40,pixels:new Uint32Array(320)},actionToPixels:null,isVisible:!0},{pixelsLayer:{width:3,height:3,x:0,y:0,pixels:this.getCursorPixels()},actionToPixels:null,isVisible:!0}),this.drawUI()},t.prototype.getLayers=function(){this.layers[1].pixelsLayer.x=this.mouseUIPosition.x-1,this.layers[1].pixelsLayer.y=this.mouseUIPosition.y-1;for(var t=[],i=0;i<this.layers.length;i++)this.layers[i].isVisible&&t.push(this.layers[i].pixelsLayer);return t},t.prototype.setRendererSize=function(t,i){this.frameWidth=t,this.frameHeight=i},t.prototype.setMousePosition=function(t){this.mousePosition=t,this.mouseUIPosition.x=t.x-this.framePosition.x,this.mouseUIPosition.y=t.y-this.framePosition.y},t.prototype.setFramePosition=function(t){this.framePosition=t,this.mouseUIPosition.x=this.mousePosition.x-this.framePosition.x,this.mouseUIPosition.y=this.mousePosition.y-this.framePosition.y},t.prototype.findAction=function(t){var i=this.actions[t];return i||function(){}},t.prototype.drawRectangleOnLayer=function(t,i,e,n,o,r,a){void 0===a&&(a=null);var s=e+o,l=n+r,u=t.pixelsLayer,h=t.actionToPixels,d=u.pixels,f=u.width,c=u.height;if(e<f&&n<c&&e>=0&&n>=0){for(var y=n;y<l;y++)for(var m=(c-1-y)*f,p=m+e;p<m+o;p++)d[p]=i;if(null!==a){if(null===h){for(var v=new Array(f),g=new Array(c),S=0;S<c;S++)g[S]=null;for(S=0;S<v.length;S++)v[S]=g.slice(0);t.actionToPixels=v}for(var P=e;P<s;P+=1)for(var w=n;w<l;w+=1)t.actionToPixels[P][w]=a}}},t.prototype.drawCreationMenu=function(t,i){var e,r,a,s,l=this,u=[{color:(0,o.getNotTransparent)((0,n.getUnitTypeByUnitTypeName)("pure-water").unitDefaultColor.baseColor),actionType:"switch-create-pure-water"},{color:(0,o.getNotTransparent)((0,n.getUnitTypeByUnitTypeName)("yellow-sand").unitDefaultColor.baseColor),actionType:"switch-create-yellow-sand"},{color:(0,o.getNotTransparent)((0,n.getUnitTypeByUnitTypeName)("gray-rock").unitDefaultColor.baseColor),actionType:"switch-create-gray-rock"},{color:(0,o.getNotTransparent)((0,n.getUnitTypeByUnitTypeName)("flammable-gas").unitDefaultColor.baseColor),actionType:"switch-create-flammable-gas"},{color:(0,o.getNotTransparent)((0,n.getUnitTypeByUnitTypeName)("red-blood").unitDefaultColor.baseColor),actionType:"switch-create-red-blood"},{color:(0,o.getNotTransparent)((0,n.getUnitTypeByUnitTypeName)("black-oil").unitDefaultColor.baseColor),actionType:"switch-create-black-oil"},{color:(0,o.getNotTransparent)((0,n.getUnitTypeByUnitTypeName)("rock-hard").unitDefaultColor.baseColor),actionType:"switch-create-rock-hard"},{color:(0,o.getNotTransparent)((0,n.getUnitTypeByUnitTypeName)("wood-wall").unitDefaultColor.baseColor),actionType:"switch-create-wood-wall"},{color:4278190335,actionType:"switch-remove"},{color:(0,o.getNotTransparent)((0,n.getUnitTypeByUnitTypeName)("yellow-flame").unitDefaultColor.baseColor),actionType:"switch-ignite"}];e=4,r=4,a=t,s=i,u.forEach((function(t){l.drawRectangleOnLayer(l.layers[0],t.color,a,s,e,e,t.actionType),s+=e+r}))},t.prototype.drawUI=function(){this.drawCreationMenu(0,0)},t.prototype.handleClickDown=function(t){this.setMousePosition(t),this.isMouseDown=!0},t.prototype.handleClickUp=function(t){this.setMousePosition(t),this.isMouseDown=!1},t.prototype.collectActions=function(){var t=this;if(this.isMouseDown){for(var i=this.mousePosition.x,e=this.mousePosition.y,n=!1,o=function(o){var a=r.layers[o];if(!a.actionToPixels||null===a.actionToPixels)return"continue";var s=!1,l=!1;if(i>=a.pixelsLayer.x&&i<a.pixelsLayer.x+a.pixelsLayer.width&&(s=!0),e>=a.pixelsLayer.y&&e<a.pixelsLayer.y+a.pixelsLayer.height&&(l=!0),!s||!l)return"continue";var u=i-a.pixelsLayer.x,h=e-a.pixelsLayer.y,d=a.actionToPixels[u][h];if(d){var f=r.findAction(d);r.eventsStack.push((function(){return f(t.mousePosition)})),n=!0}},r=this,a=this.layers.length-1;a>=0;a--)o(a);if(!n){var s=this.findAction("default-action");this.eventsStack.push((function(){return s(t.mousePosition)}))}}var l=this.eventsStack;return this.eventsStack=[],l},t}();i.UI=r},900:function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.Unit=void 0;var n=e(987),o=e(527),r=function(){function t(t,i,e,r){if(void 0===i&&(i=null),void 0===e&&(e=0),void 0===r&&(r=null),this.isUpdated=!1,this.unitTypeName=t,this.unitVelocityVector=i,this.unitId=e,r)this.unitState=r;else{var a=(0,n.getUnitTypeByUnitTypeName)(t),s=a.unitDefaultColor,l=a.unitDefaultHealth,u=a.unitDefaultFlameSustainability,h=a.unitDefaultFireHP,d=(0,o.getRandomInt)(s.minRandomColor,s.maxRandomColor),f=(15&s.colorShiftNumbers)>>3,c=(240&s.colorShiftNumbers)>>4>>3,y=(3840&s.colorShiftNumbers)>>8>>3,m=d*f+d*Math.pow(16,2)*c+d*Math.pow(16,4)*y,p=s.baseColor+m;this.unitState={unitHealth:l,unitIsOnFire:!1,unitColor:p,unitDecalColor:0,flameSustainability:u,fireHP:h}}}return t.prototype.getUnitType=function(){return(0,n.getUnitTypeByUnitTypeName)(this.unitTypeName)},t.prototype.toJson=function(){var t={h:this.unitState.unitHealth,f:Number(this.unitState.unitIsOnFire),c:this.unitState.unitColor,d:this.unitState.unitDecalColor,s:this.unitState.flameSustainability,j:this.unitState.fireHP},i={n:this.unitTypeName,i:this.unitId,s:t};return this.unitVelocityVector&&(i.v={s:this.unitVelocityVector.startPoint,e:this.unitVelocityVector.endPoint}),i},t}();i.Unit=r},273:function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.Renderer=void 0;var n=e(527),o=function(){function t(t){var i=this;this.pixelSize=1,this.wallColor=4278190080,this.layersMapping={physics:0,ui:1,crosshair:2},this.layers=[],this.lastFrameTime=(new Date).getTime(),this.getScreenSizeX=function(){return i.width},this.getScreenSizeY=function(){return i.height},this.getPixelsCount=function(){return i.width*i.height/Math.pow(i.pixelSize,2)},this.getPixelSize=function(){return i.pixelSize},this.getLastFrameTime=function(){return i.lastFrameTime},this.canvas=t,this.width=this.canvas.width,this.height=this.canvas.height,this.desiredWidth=this.canvas.width,this.desiredHeight=this.canvas.height,this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize)),this.initLayers()}return t.prototype.initLayers=function(){this.layers.push({width:this.width/this.pixelSize,height:this.height/this.pixelSize,x:0,y:0,pixels:new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))})},t.prototype.setLayerPixels=function(t,i){var e=this.layersMapping[t];void 0!==e&&(this.layers[e].pixels=i)},t.prototype.updateLayerPosition=function(t,i,e){var n=this.layersMapping[t];void 0!==n&&(this.layers[n].x=i,this.layers[n].y=e)},t.prototype.updateLayerSize=function(t,i,e){var n=this.layersMapping[t];void 0!==n&&(this.layers[n].width=i,this.layers[n].height=e)},t.prototype.updateLayer=function(t,i){var e=this.layersMapping[t];void 0!==e&&(this.layers[e].width=i.width,this.layers[e].height=i.height,this.layers[e].x=i.x,this.layers[e].y=i.y,this.layers[e].pixels=i.pixels)},t.prototype.setScreenSize=function(t,i){this.desiredWidth=t,this.desiredHeight=i,this.width=Math.floor(t/this.pixelSize)*this.pixelSize,this.height=Math.floor(i/this.pixelSize)*this.pixelSize,this.canvas.width=this.width,this.canvas.height=this.height,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))},t.prototype.setPixelSize=function(t){this.pixelSize=t,this.setScreenSize(this.desiredWidth,this.desiredHeight)},t.prototype.getPixels=function(){return this.virtualPixels},t.prototype.setPixels=function(t){this.virtualPixels=t},t.prototype.blendPixelLayers=function(t,i,e){if(!t||0===t.length)return null;if(1===t.length)return t[0].pixels;for(var o=new Uint32Array(i*e),r=t.length-1;r>=0;r--){var a=t[r],s=a.width,l=a.height,u=a.x,h=a.y,d=0,f=0,c=0,y=0;u<0&&(d=-u),h<0&&(y=-h),l-e-y>0&&(c=e-l-y),s-i-d>0&&(f=e-l-y);for(var m=0+y;m<l-c;m++)for(var p=(l-1-m)*s,v=p+d;v<p+s-f;v++){var g=(e-(h+m)-1)*i+(u+(v-p)),S=o[g],P=a.pixels[v];null==S||0===S?o[g]=P:null!=P&&(o[g]=Number((0,n.mixColors)(P,S)))}}return o},t.prototype.render=function(t){var i=function(t,i,e,n){return(n-i-1)*e+t},e=this,n=e.width,o=e.height,r=e.pixelSize,a=e.realPixels,s=e.virtualPixels,l=e.ctx,u=e.imageData,h=e.lastFrameTime;performance.mark("start");for(var d=n/r,f=o/r,c=0;c<f;c++)for(var y=c*r,m=0;m<d;m++)for(var p=m*r,v=s[i(m,c,d,f)],g=0;g<r;g++)for(var S=p+g,P=0;P<r;P++){a[i(S,y+P,n,o)]=v}l.putImageData(u,0,0),performance.mark("end");var w=performance.measure("Measurement","start","end");1e3/(performance.now()-h)==1/0&&(this.lastFrameTime=performance.now()),l.font="10px serif",l.fillStyle="red",l.fillText("FPS: ".concat(String(1e3/(performance.now()-h)).slice(0,6)),0,10),l.fillText("render: ".concat(String(w.duration).slice(0,4)),0,30),this.lastFrameTime=performance.now()},t}();i.Renderer=o},527:function(t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getNotTransparent=i.mixColors=i.getRandomInt=void 0;i.getRandomInt=function(t,i){var e=Math.ceil(t),n=Math.floor(i);return Math.floor(Math.random()*(n-e+1))+e};i.mixColors=function(t,i){var e=Number(BigInt(i)>>BigInt(24));if(255===e)return i;var n=Number(BigInt(t)>>BigInt(24))/255,o=e/255,r=Number(BigInt(t)&BigInt(16777215)),a=Number(BigInt(i)&BigInt(16777215)),s=(1-n)*o+n,l=function(t,i,e,n,o){return Math.round(((1-e)*n*i+e*t)/o)||0},u=(65280&r)>>8,h=(16711680&r)>>16,d=(65280&a)>>8,f=(16711680&a)>>16,c=l(255&r,255&a,n,o,s),y=l(u,d,n,o,s),m=(l(h,f,n,o,s)<<16)+(y<<8)+c;return(BigInt(Math.round(255*s))<<BigInt(24))+BigInt(m)};i.getNotTransparent=function(t){return 4278190080+(16777215&t)}}},i={};function e(n){var o=i[n];if(void 0!==o)return o.exports;var r=i[n]={exports:{}};return t[n].call(r.exports,r,r.exports,e),r.exports}e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};!function(){e(213);var t=new(e(844).App);t.setScreenSize(document.body.offsetWidth,document.body.offsetHeight),t.setPixelSize(6),t.start()}()}();