!function(){"use strict";var t={213:function(t,e,i){i.r(e)},844:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.App=void 0;var r=n(i(632)),o=i(648),a=function(){function t(){var t=this;this.worldSideSize=1e3,this.engine=new r.default(this.worldSideSize),this.canvas=document.createElement("canvas"),this.isStarted=!1,this.frameHeight=10,this.frameWidth=10,this.framePositionX=0,this.framePositionY=0,this.realMousePosition={x:0,y:0},this.virtualMousePosition={x:0,y:0},this.matterType=0,this.pointerSquareSize=0,this.isPause=!1,this.gameMaxCountMaterials=5,document.body.appendChild(this.canvas);var e=function(t,e){var i=t.getBoundingClientRect(),n=e.touches[0],r=t.width/i.width,o=t.height/i.height;return{x:(n.clientX-i.left)*r,y:(n.clientY-i.top)*o}},i=function(e){t.realMousePosition=e;var i=t.renderer.getPixelSize();t.virtualMousePosition.x=t.framePositionX+Math.floor(e.x/i),t.virtualMousePosition.y=t.framePositionY+(t.frameHeight-1-Math.floor(e.y/i)),t.engine.setMousedPosition(t.virtualMousePosition)};this.canvas.addEventListener("mousemove",(function(e){var n=function(t,e){var i=t.getBoundingClientRect(),n=t.width/i.width,r=t.height/i.height;return{x:(e.clientX-i.left)*n,y:(e.clientY-i.top)*r}}(t.canvas,e);i(n)}),!1),this.canvas.addEventListener("touchmove",(function(n){var r=e(t.canvas,n);i(r)}),!1),this.canvas.addEventListener("wheel",(function(e){-e.deltaY<0?t.pointerSquareSize>0&&(t.pointerSquareSize-=1):-e.deltaY>0&&t.pointerSquareSize<2*t.frameHeight&&(t.pointerSquareSize+=1)}),!1);var n,a,s,u,l;n=this.canvas,a=function(){return t.engine.createUnitAtPoint(t.virtualMousePosition,t.matterType,t.pointerSquareSize)},u=function(n){if("mousedown"===n.type&&n instanceof MouseEvent)0===n.button&&(s=window.setInterval(a,1));else if(n instanceof TouchEvent){var r=e(t.canvas,n);i(r),s=window.setInterval(a,1)}},l=function(){s&&window.clearInterval(s)},n.addEventListener("mousedown",u),n.addEventListener("mouseup",l),n.addEventListener("mouseout",l),n.addEventListener("touchstart",u),n.addEventListener("touchend",l),this.canvas.addEventListener("mousedown",(function(e){1===e.button&&(t.matterType<t.gameMaxCountMaterials?t.matterType+=1:t.matterType=0)}),!1),document.addEventListener("keydown",(function(e){"ArrowRight"===e.key&&t.framePositionX<t.worldSideSize-t.frameWidth&&(t.framePositionX+=1),"ArrowLeft"===e.key&&t.framePositionX>0&&(t.framePositionX-=1),"ArrowUp"===e.key&&t.framePositionY<t.worldSideSize-t.frameHeight&&(t.framePositionY+=1),"ArrowDown"===e.key&&t.framePositionY>0&&(t.framePositionY-=1)," "===e.key&&(t.isPause=!t.isPause,t.engine.setPause(t.isPause)),"s"===e.key&&t.engine.saveToLocalStorage(),"l"===e.key&&t.engine.loadFromLocalStorage()})),this.renderer=new o.Renderer(this.canvas)}return t.prototype.setScreenSize=function(t,e){this.renderer.setScreenSize(t,e);var i=Math.floor(t/this.renderer.getPixelSize()),n=Math.floor(e/this.renderer.getPixelSize());this.engine.setRendererSize(i,n),this.frameWidth=Math.floor(i),this.frameHeight=Math.floor(n)},t.prototype.setPixelSize=function(t){this.renderer.setPixelSize(t);var e=Math.floor(this.renderer.getScreenSizeX()/this.renderer.getPixelSize()),i=Math.floor(this.renderer.getScreenSizeY()/this.renderer.getPixelSize());console.error(e,i),this.engine.setRendererSize(e,i),this.frameWidth=e,this.frameHeight=i},t.prototype.start=function(){this.isStarted||(this.renderer.getPixels().fill(4278190080),this.isStarted=!0,this.startRender())},t.prototype.startRender=function(){var t=this,e=function(i){t.renderer.setPixels(t.engine.requestFrame(t.frameWidth,t.frameHeight,t.framePositionX,t.framePositionY)),t.renderer.render(i),window.requestAnimationFrame(e)};e(0)},t}();e.App=a},632:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(i(575)),o=n(i(199)),a=function(){function t(t){this.frameWidth=0,this.frameHeight=0,this.framePositionX=0,this.framePositionY=0,this.physicEngine=new r.default,this.worldSquareSide=2,this.mousePosition={x:0,y:0},this.lastUnitId=0,this.save="",this.isPhysicsEnginePause=!1,this.gameWorldState=Array.from(Array(4),(function(){return new Array(4)})),this.worldSquareSide=t,this.gameWorldState=Array.from(Array(t),(function(){return new Array(t)}))}return t.prototype.setPause=function(t){this.isPhysicsEnginePause=t},t.prototype.setMousedPosition=function(t){this.mousePosition=t},t.prototype.setRendererSize=function(t,e){this.frameWidth=t,this.frameHeight=e},t.prototype.extractFrame=function(t,e,i,n){for(var r,o=new Uint32Array(t*e),a=(e-1)*t,s=n;s<n+e;s+=1){for(var u=i;u<i+t;u+=1)null!==this.gameWorldState[u][s]&&(o[a]=(null===(r=this.gameWorldState[u][s])||void 0===r?void 0:r.unitState.unitColor)||0),a+=1;a-=2*t}return o},t.prototype.createUnitAtPoint=function(t,e,i){var n=function(){var t="pure-water";switch(e){case 0:t="pure-water";break;case 1:t="yellow-sand";break;case 2:t="gray-rock";break;case 3:t="flammable-gas";break;case 4:t="red-blood";break;case 5:return null}return new o.default(t,null,0)};if(i>0)for(var r=Math.floor(t.x/i)*i,a=Math.floor(t.y/i)*i,s=0;s<i;s+=1)for(var u=0;u<i;u+=1){var l=n();r+u<this.worldSquareSide&&a+s<this.worldSquareSide&&(this.gameWorldState[r+u][a+s]&&null!==l||(this.gameWorldState[r+u][a+s]=l,null!==l&&(l.unitId=this.lastUnitId++)))}else{var d=n();this.gameWorldState[t.x][t.y]&&null!==d||(this.gameWorldState[t.x][t.y]=d,null!==d&&(d.unitId=this.lastUnitId++))}},t.prototype.requestFrame=function(t,e,i,n){return this.isPhysicsEnginePause||(this.gameWorldState=this.physicEngine.resolveWorld(this.gameWorldState,this.worldSquareSide)),this.extractFrame(t,e,i,n)},t.prototype.convertWorldStateToSave=function(){for(var t={},e=0;e<this.worldSquareSide;e+=1)for(var i=0;i<this.worldSquareSide;i+=1)null!=this.gameWorldState[e][i]&&(t[e]||(t[e]={}),t[e][i]=this.gameWorldState[e][i]);return t},t.prototype.serializeToSaveFile=function(){var t={frameWidth:this.frameWidth,frameHeight:this.frameHeight,framePositionX:this.framePositionX,framePositionY:this.framePositionY,worldSideSize:this.worldSquareSide,lastUnitId:this.lastUnitId,worldSate:this.convertWorldStateToSave()};return console.error(t),this.save=JSON.stringify(t),JSON.stringify(t)},t.prototype.convertSaveToWorldState=function(t,e){var i=Array.from(Array(e),(function(){return new Array(e)}));return Object.keys(t).forEach((function(e){t[parseInt(e,10)]&&Object.keys(t[parseInt(e,10)]).forEach((function(n){if(t[parseInt(e,10)][parseInt(n,10)]){var r=t[parseInt(e,10)][parseInt(n,10)],a=new o.default(r.unitTypeName,null,r.unitId,r.unitState);i[parseInt(e,10)][parseInt(n,10)]=a}}))})),i},t.prototype.deserializeAnLoadFromFile=function(t){void 0===t&&(t=this.save);var e=JSON.parse(t);if(t&&"{"===t[0]){var i=Object.keys(e).length;e&&i>0&&e.worldSate&&(this.frameWidth=e.frameWidth,this.frameHeight=e.frameHeight,this.framePositionX=e.framePositionX,this.framePositionY=e.framePositionY,this.worldSquareSide=e.worldSideSize,this.lastUnitId=e.lastUnitId,this.gameWorldState=this.convertSaveToWorldState(e.worldSate,e.worldSideSize))}},t.prototype.saveToLocalStorage=function(){localStorage.setItem("pws-save",this.serializeToSaveFile())},t.prototype.loadFromLocalStorage=function(){var t=localStorage.getItem("pws-save");t&&this.deserializeAnLoadFromFile(t)},t}();e.default=a},575:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(i(283)),o=function(){function t(){this.lastY=0,this.isLineByLineResolve=!1}return t.prototype.resolveWorld=function(t,e){for(var i,n=function(e,i,n,r,o){void 0===o&&(o=!0);var a=t[n][r];t[n][r]=t[e][i],t[n][r]&&(t[n][r].isUpdated=o),t[e][i]=a,t[e][i]&&(t[e][i].isUpdated=o)},o=function(i,r,o,a,s){if(void 0===s&&(s=!0),t[o][a]){var u=function(i,r,o){var a=function(o){return t[i][r+o]?i>0&&!t[i-1][r+o]?(n(i,r,i-1,r+o),!0):i<e-1&&!t[i+1][r+o]&&(n(i,r,i+1,r+o),!0):(n(i,r,i,r+o),!0)},s=o?-1:1;if(r>0){if(a(1*s))return!0}else{if(i>0&&!t[i-1][r])return n(i,r,i-1,r),!0;if(i<e-1&&!t[i+1][r])return n(i,r,i+1,r),!0;if(r<e-1&&a(-1*s))return!0}return!1}(o,a,t[o][a].getUnitType().unitIsLiquid);u||n(i,r,o,a,s)}else n(i,r,o,a,s)},a=function(i,a){var s,u,l;(null===(s=t[i][a])||void 0===s?void 0:s.isUpdated)||((null===(u=t[i][a])||void 0===u?void 0:u.getUnitType().unitIsGas)?function(i,o){var a=i>0&&!t[i-1][o],s=i<e-1&&!t[i+1][o];if(o<=e-1){var u=!t[i][o+1],l=i>0&&!t[i-1][o+1],d=i<e-1&&!t[i+1][o+1],h=l&&d,f=a&&s;if(u)n(i,o,i,o+1);else if(h&&f){var v=(0,r.default)(0,1);n(i,o,0===v?i-1:i+1,o+1)}else l&&a?n(i,o,i-1,o+1):d&&s?n(i,o,i+1,o+1):a?n(i,o,i-1,o):s&&n(i,o,i+1,o)}else o===e-1&&(a?n(i,o,i-1,o):s&&n(i,o,i+1,o))}(i,a):(null===(l=t[i][a])||void 0===l?void 0:l.getUnitType().unitIsLiquid)?function(i,o){var a,s,u,l,d,h,f,v,c,p,m=i>0&&!t[i-1][o],y=i>0&&!m&&!m&&(null===(a=t[i-1][o])||void 0===a?void 0:a.isUpdated),g=i>0&&!m&&(null===(s=t[i-1][o])||void 0===s?void 0:s.getUnitType().unitIsLiquid)&&t[i-1][o].getUnitType().unitDensity<t[i][o].getUnitType().unitDensity,S=i>0&&!m&&(null===(u=t[i-1][o])||void 0===u?void 0:u.getUnitType().unitIsGas),w=i<e-1&&!t[i+1][o],T=i<e-1&&!w&&(null===(l=t[i+1][o])||void 0===l?void 0:l.isUpdated),x=i<e-1&&!w&&(null===(d=t[i+1][o])||void 0===d?void 0:d.getUnitType().unitIsLiquid)&&t[i+1][o].getUnitType().unitDensity<t[i][o].getUnitType().unitDensity,P=i<e-1&&!w&&(null===(h=t[i+1][o])||void 0===h?void 0:h.getUnitType().unitIsGas);if(o>0){var I=!t[i][o-1],U=!I&&(null===(f=t[i][o-1])||void 0===f?void 0:f.getUnitType().unitIsLiquid)&&t[i][o-1].getUnitType().unitDensity<t[i][o].getUnitType().unitDensity,z=!I&&(null===(v=t[i][o-1])||void 0===v?void 0:v.getUnitType().unitIsGas),D=i>0&&!t[i-1][o-1],M=i>0&&!D&&t[i-1][o-1].getUnitType().unitIsLiquid&&t[i-1][o-1].getUnitType().unitDensity<t[i][o].getUnitType().unitDensity,b=i>0&&!D&&t[i-1][o-1].getUnitType().unitIsGas,L=i>0&&!D&&(null===(c=t[i-1][o-1])||void 0===c?void 0:c.isUpdated),q=i<e-1&&!t[i+1][o-1],C=i<e-1&&!q&&t[i+1][o-1].getUnitType().unitIsLiquid&&t[i+1][o-1].getUnitType().unitDensity<t[i][o].getUnitType().unitDensity,W=i<e-1&&!q&&t[i+1][o-1].getUnitType().unitIsGas,F=i<e-1&&!q&&(null===(p=t[i+1][o-1])||void 0===p?void 0:p.isUpdated),_=D&&q,A=M&&C,R=b&&W,H=m&&w,Y=y&&T,k=g&&x,E=S&&P;if(I||U||z)n(i,o,i,o-1);else if(!Y&&(_||A||R)&&(H||k||E)){var G=(0,r.default)(0,1);n(i,o,0===G?i-1:i+1,o-1)}else!L&&(D||M||b)&&(m||g||S)?n(i,o,i-1,o-1):!F&&(q||C||W)&&(w||x||P)?n(i,o,i+1,o-1):!y&&(m||g||S)?n(i,o,i-1,o):!T&&(w||x||P)&&n(i,o,i+1,o)}else 0===o&&(!y&&(m||g||S)?n(i,o,i-1,o):!T&&(w||x||P)&&n(i,o,i+1,o))}(i,a):function(i,a){var s,u,l,d,h,f,v,c,p,m;if(!(a<=0)){var y=!1,g=!1,S=!1,w=!1,T=!1,x=!1,P=!1,I=!1,U=!1,z=!1,D=!1,M=!1;i>0&&((y=!t[i-1][a])||(g=!!(null===(s=t[i-1][a])||void 0===s?void 0:s.getUnitType().unitIsLiquid),S=!!(null===(u=t[i-1][a])||void 0===u?void 0:u.getUnitType().unitIsGas)),(P=!t[i-1][a-1])||(I=!!(null===(l=t[i-1][a-1])||void 0===l?void 0:l.getUnitType().unitIsLiquid),U=!!(null===(d=t[i-1][a-1])||void 0===d?void 0:d.getUnitType().unitIsGas))),i<e-1&&((w=!t[i+1][a])||(T=!!(null===(h=t[i+1][a])||void 0===h?void 0:h.getUnitType().unitIsLiquid),x=!!(null===(f=t[i+1][a])||void 0===f?void 0:f.getUnitType().unitIsGas)),(z=!t[i+1][a-1])||(D=!!(null===(v=t[i+1][a-1])||void 0===v?void 0:v.getUnitType().unitIsLiquid),M=!!(null===(c=t[i+1][a-1])||void 0===c?void 0:c.getUnitType().unitIsGas)));var b=t[i][a-1]&&((null===(p=t[i][a-1])||void 0===p?void 0:p.getUnitType().unitIsLiquid)||(null===(m=t[i][a-1])||void 0===m?void 0:m.getUnitType().unitIsGas)),L=y||g||S,q=w||T||x,C=P||I||U,W=z||D||M,F=C&&W,_=L&&q;if(!t[i][a-1]||b)b?a<e-1&&o(i,a,i,a-1):t[i][a-1]||n(i,a,i,a-1);else if(F&&_){var A=(0,r.default)(0,1);o(i,a,0===A?i-1:i+1,a-1)}else C&&L?o(i,a,i-1,a-1):W&&q&&o(i,a,i+1,a-1)}}(i,a))},s=function(e,i){var n;null!=t[e][i]&&((null===(n=t[e][i])||void 0===n?void 0:n.getUnitType().unitIsStatic)||a(e,i))},u=0;u<e;u+=1)for(var l=0;l<e;l+=1)null!=t[l][u]&&((null===(i=t[l][u])||void 0===i?void 0:i.getUnitType().unitIsStatic)||(t[l][u].isUpdated=!1));var d=function(t){if(!1===Boolean((0,r.default)(0,1)))for(var i=0;i<e;i+=1)s(i,t);else for(i=e-1;i>=0;i-=1)s(i,t)};if(this.isLineByLineResolve){u=0;this.lastY<e?u=this.lastY++:this.lastY=0,d(u)}else for(u=0;u<e;u+=1)d(u);return t},t}();e.default=o},648:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;var i=function(){function t(t){var e=this;this.pixelSize=1,this.wallColor=4278190080,this.lastFrameTime=(new Date).getTime(),this.getScreenSizeX=function(){return e.width},this.getScreenSizeY=function(){return e.height},this.getPixelsCount=function(){return e.width*e.height/Math.pow(e.pixelSize,2)},this.getPixelSize=function(){return e.pixelSize},this.getLastFrameTime=function(){return e.lastFrameTime},this.canvas=t,this.width=this.canvas.width,this.height=this.canvas.height,this.desiredWidth=this.canvas.width,this.desiredHeight=this.canvas.height,this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))}return t.prototype.setScreenSize=function(t,e){this.desiredWidth=t,this.desiredHeight=e,this.width=Math.floor(t/this.pixelSize)*this.pixelSize,this.height=Math.floor(e/this.pixelSize)*this.pixelSize,this.canvas.width=this.width,this.canvas.height=this.height,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))},t.prototype.setPixelSize=function(t){this.pixelSize=t,this.setScreenSize(this.desiredWidth,this.desiredHeight)},t.prototype.render=function(t){for(var e=function(t,e,i,n){return(n-e-1)*i+t},i=0;i<this.height/this.pixelSize;i++)for(var n=0;n<this.width/this.pixelSize;n++)for(var r=0;r<this.pixelSize;r++)for(var o=0;o<this.pixelSize;o++){var a=e(n*this.pixelSize+r,i*this.pixelSize+o,this.width,this.height),s=e(n,i,this.width/this.pixelSize,this.height/this.pixelSize);this.realPixels[a]=this.virtualPixels[s]}this.ctx.putImageData(this.imageData,0,0),1e3/(performance.now()-this.lastFrameTime)==1/0&&(this.lastFrameTime=performance.now()),this.ctx.font="10px serif",this.ctx.fillStyle="red",this.ctx.fillText("FPS: ".concat(String(1e3/(performance.now()-this.lastFrameTime))),0,10),this.lastFrameTime=performance.now()},t.prototype.getPixels=function(){return this.virtualPixels},t.prototype.setPixels=function(t){this.virtualPixels=t},t}();e.Renderer=i},199:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=i(281),o=n(i(283)),a=function(){function t(t,e,i,n){if(void 0===e&&(e=null),void 0===i&&(i=0),void 0===n&&(n=null),this.isUpdated=!1,this.unitTypeName=t,this.unitVelocityVector=e,this.unitId=i,n)this.unitState=n;else{var a=(0,r.getUnitTypeByUnitTypeName)(t),s=a.unitDefaultColor,u=(0,o.default)(s.minRandomColor,s.maxRandomColor),l=u+u*Math.pow(16,2)+u*Math.pow(16,4),d=s.baseColor+l;this.unitState={unitHealth:a.unitDefaultHealth,unitIsOnFire:!1,unitColor:d}}}return t.prototype.getUnitType=function(){return(0,r.getUnitTypeByUnitTypeName)(this.unitTypeName)},t}();e.default=a},281:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getUnitTypeByUnitTypeName=e.UnitTypesArray=e.UnitTypesStringsToIndex=void 0,e.UnitTypesStringsToIndex={"yellow-sand":0,"pure-water":1,"gray-rock":2,"flammable-gas":3,"red-blood":4},e.UnitTypesArray=[{unitName:"yellow-sand",unitIsLiquid:!1,unitIsStatic:!1,unitIsGas:!1,unitIsFlammable:!1,unitDefaultHealth:10,unitDensity:1.5,unitDefaultColor:{minRandomColor:10,maxRandomColor:53,baseColor:4278241994},unitTransformations:{toFreeze:"yellow-sand",toLiquid:"molten-glass",toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"pure-water",unitIsLiquid:!0,unitIsStatic:!1,unitIsGas:!1,unitIsFlammable:!1,unitDefaultHealth:10,unitDensity:1,unitDefaultColor:{minRandomColor:0,maxRandomColor:0,baseColor:2013255936},unitTransformations:{toFreeze:"pure-ice",toLiquid:"pure-water",toVapor:"water-steam",toDestroy:"water-steam",toCorrode:"water-steam"}},{unitName:"gray-rock",unitIsLiquid:!1,unitIsStatic:!0,unitIsGas:!1,unitIsFlammable:!1,unitDefaultHealth:100,unitDensity:2.6,unitDefaultColor:{minRandomColor:10,maxRandomColor:82,baseColor:4286677377},unitTransformations:{toFreeze:null,toLiquid:"molten-rock",toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"flammable-gas",unitIsLiquid:!1,unitIsStatic:!1,unitIsGas:!0,unitIsFlammable:!0,unitDefaultHealth:10,unitDensity:.00182,unitDefaultColor:{minRandomColor:10,maxRandomColor:82,baseColor:856795648},unitTransformations:{toFreeze:null,toLiquid:"flammable-liquid",toVapor:null,toDestroy:null,toCorrode:null}},{unitName:"red-blood",unitIsLiquid:!0,unitIsStatic:!1,unitIsGas:!1,unitIsFlammable:!1,unitDefaultHealth:10,unitDensity:1.03,unitDefaultColor:{minRandomColor:0,maxRandomColor:0,baseColor:4278190257},unitTransformations:{toFreeze:"frozen-red-blood",toLiquid:null,toVapor:null,toDestroy:null,toCorrode:null}}];e.getUnitTypeByUnitTypeName=function(t){var i=e.UnitTypesStringsToIndex[t];return e.UnitTypesArray[i]}},283:function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e){var i=Math.ceil(t),n=Math.floor(e);return Math.floor(Math.random()*(n-i+1))+i}}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};!function(){i(213);var t=new(i(844).App);t.setScreenSize(1e3,1e3),t.setPixelSize(6),t.start()}()}();