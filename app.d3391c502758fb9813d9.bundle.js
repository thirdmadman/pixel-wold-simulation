!function(){"use strict";var e={213:function(e,t,i){i.r(t)},844:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var n=r(i(632)),o=i(648),s=function(){function e(){var e=this;this.worldSideSize=100,this.engine=new n.default(this.worldSideSize),this.canvas=document.createElement("canvas"),this.isStarted=!1,this.frameHeight=10,this.frameWidth=10,this.framePositionX=0,this.framePositionY=0,this.realMousePosition={x:0,y:0},this.virtualMousePosition={x:0,y:0},this.matterType=0,this.pointerSquareSize=0,this.isPause=!1,this.lastFrame=0,document.body.appendChild(this.canvas);var t=function(e,t){var i=e.getBoundingClientRect(),r=t.touches[0],n=e.width/i.width,o=e.height/i.height;return{x:(r.clientX-i.left)*n,y:(r.clientY-i.top)*o}},i=function(t){e.realMousePosition=t;var i=e.renderer.getPixelSize();e.virtualMousePosition.x=e.framePositionX+Math.floor(t.x/i),e.virtualMousePosition.y=e.framePositionY+(e.frameHeight-1-Math.floor(t.y/i)),e.engine.setMousedPosition(e.virtualMousePosition)};this.canvas.addEventListener("mousemove",(function(t){var r=function(e,t){var i=e.getBoundingClientRect(),r=e.width/i.width,n=e.height/i.height;return{x:(t.clientX-i.left)*r,y:(t.clientY-i.top)*n}}(e.canvas,t);i(r)}),!1),this.canvas.addEventListener("touchmove",(function(r){var n=t(e.canvas,r);i(n)}),!1),this.canvas.addEventListener("wheel",(function(t){-t.deltaY<0?e.pointerSquareSize>0&&(e.pointerSquareSize-=1):-t.deltaY>0&&e.pointerSquareSize<2*e.frameHeight&&(e.pointerSquareSize+=1)}),!1);var r,s,a,h,u;r=this.canvas,s=function(){return e.engine.createUnitAtPoint(e.virtualMousePosition,e.matterType,e.pointerSquareSize)},h=function(r){if("mousedown"===r.type&&r instanceof MouseEvent)0===r.button&&(a=window.setInterval(s,1));else if(r instanceof TouchEvent){var n=t(e.canvas,r);i(n),a=window.setInterval(s,1)}},u=function(){a&&window.clearInterval(a)},r.addEventListener("mousedown",h),r.addEventListener("mouseup",u),r.addEventListener("mouseout",u),r.addEventListener("touchstart",h),r.addEventListener("touchend",u),this.canvas.addEventListener("mousedown",(function(t){1===t.button&&(e.matterType<3?e.matterType+=1:e.matterType=0)}),!1),this.renderer=new o.Renderer(this.canvas),document.addEventListener("keydown",(function(t){"ArrowRight"===t.key&&e.framePositionX<e.worldSideSize-e.frameWidth&&(e.framePositionX+=1),"ArrowLeft"===t.key&&e.framePositionX>0&&(e.framePositionX-=1),"ArrowUp"===t.key&&e.framePositionY<e.worldSideSize-e.frameHeight&&(e.framePositionY+=1),"ArrowDown"===t.key&&e.framePositionY>0&&(e.framePositionY-=1)," "===t.key&&(e.isPause=!e.isPause)}))}return e.prototype.setScreenSize=function(e,t){this.renderer.setScreenSize(e,t),this.engine.setRendererSize(Math.floor(e/this.renderer.getPixelSize()),Math.floor(t/this.renderer.getPixelSize())),this.frameWidth=Math.floor(e/this.renderer.getPixelSize()),this.frameHeight=Math.floor(t/this.renderer.getPixelSize())},e.prototype.setPixelSize=function(e){this.renderer.setPixelSize(e),this.engine.setRendererSize(Math.floor(this.renderer.getScreenSizeX()/this.renderer.getPixelSize()),Math.floor(this.renderer.getScreenSizeY()/this.renderer.getPixelSize())),this.frameWidth=Math.floor(this.renderer.getScreenSizeX()/this.renderer.getPixelSize()),this.frameHeight=Math.floor(this.renderer.getScreenSizeY()/this.renderer.getPixelSize())},e.prototype.start=function(){this.isStarted||(this.renderer.getPixels().fill(4278190080),this.isStarted=!0,this.startRender())},e.prototype.startRender=function(){var e=this,t=function(){e.isPause||Date.now()-e.lastFrame>=12&&(e.renderer.setPixels(e.engine.requestFrame(e.frameWidth,e.frameHeight,e.framePositionX,e.framePositionY)),e.renderer.render(),e.lastFrame=Date.now()),window.requestAnimationFrame(t)};t()},e}();t.App=s},632:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(i(575)),o=r(i(199)),s=r(i(283)),a=function(){function e(e){this.frameWidth=0,this.frameHeight=0,this.framePositionX=0,this.framePositionY=0,this.physicEngine=new n.default,this.worldSquareSide=2,this.mousePosition={x:0,y:0},this.lastUnitId=0,this.gameWorldState=Array.from(Array(4),(function(){return new Array(4)})),this.worldSquareSide=e,this.gameWorldState=Array.from(Array(e),(function(){return new Array(e)}))}return e.prototype.setMousedPosition=function(e){this.mousePosition=e},e.prototype.setRendererSize=function(e,t){this.frameWidth=e,this.frameHeight=t},e.prototype.extractFrame=function(e,t,i,r){for(var n,o=new Uint32Array(e*t),s=(t-1)*e,a=r;a<r+t;a+=1){for(var h=i;h<i+e;h+=1)null!==this.gameWorldState[h][a]&&(o[s]=(null===(n=this.gameWorldState[h][a])||void 0===n?void 0:n.unitType.unitColor)||0),s+=1;s-=2*e}return o},e.prototype.createUnitAtPoint=function(e,t,i){var r=this,n=function(){var e=!1,i=0,n=!1;switch(t){case 0:e=!0,i+=2013255936;break;case 1:i+=4278241994+((a=(0,s.default)(10,53))+a*Math.pow(16,2));break;case 2:var a;n=!0,i+=4286677377+((a=(0,s.default)(10,82))+a*Math.pow(16,2)+a*Math.pow(16,4));break;case 3:return null}return new o.default({unitHealth:1,unitIsGas:!1,unitIsFlammable:!1,unitIsLiquid:e,unitIsStatic:n,unitColor:i},null,r.lastUnitId++)};if(i>0)for(var a=Math.floor(e.x/i)*i,h=Math.floor(e.y/i)*i,u=0;u<i;u+=1)for(var l=0;l<i;l+=1){var d=n();a+l<this.worldSquareSide&&h+u<this.worldSquareSide&&(this.gameWorldState[a+l][h+u]&&null!==d||(this.gameWorldState[a+l][h+u]=d))}else{var f=n();this.gameWorldState[e.x][e.y]&&null!==f||(this.gameWorldState[e.x][e.y]=f)}},e.prototype.requestFrame=function(e,t,i,r){return this.gameWorldState=this.physicEngine.resolveWorld(this.gameWorldState,this.worldSquareSide),this.extractFrame(e,t,i,r)},e}();t.default=a},575:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(i(283)),o=function(){function e(){}return e.prototype.resolveWorld=function(e,t){for(var i,r,o,s=function(t,i,r,n,o){void 0===o&&(o=!0);var s=e[r][n];e[r][n]=e[t][i],e[r][n].isUpdated=o,e[t][i]=s},a=function(i,r){var o,a;(null===(o=e[i][r])||void 0===o?void 0:o.isUpdated)||((null===(a=e[i][r])||void 0===a?void 0:a.unitType.unitIsLiquid)?function(i,r){if(r>0)if(e[i][r-1])if(i>0&&!e[i-1][r-1]&&!e[i-1][r]&&i<t-1&&!e[i+1][r-1]&&!e[i+1][r]){var o=(0,n.default)(0,1);s(i,r,0===o?i-1:i+1,r-1)}else i>0&&!e[i-1][r-1]&&!e[i-1][r]?s(i,r,i-1,r-1):i<t-1&&!e[i+1][r-1]&&!e[i+1][r]?s(i,r,i+1,r-1):i<t-1&&!e[i+1][r]?s(i,r,i+1,r):i>0&&!e[i-1][r]&&s(i,r,i-1,r);else s(i,r,i,r-1);else 0===r&&(i>0&&!e[i-1][r]?s(i,r,i-1,r):i<t-1&&!e[i+1][r]&&s(i,r,i+1,r))}(i,r):function(i,r){var o,a,h,u,l,d;if(r>0){var f=!e[i][r-1]||(null===(o=e[i][r-1])||void 0===o?void 0:o.unitType.unitIsLiquid),c=i>0&&(!e[i-1][r-1]||(null===(a=e[i-1][r-1])||void 0===a?void 0:a.unitType.unitIsLiquid)),v=i<t-1&&(!e[i+1][r-1]||(null===(h=e[i+1][r-1])||void 0===h?void 0:h.unitType.unitIsLiquid)),p=c&&v,S=i>0&&(!e[i-1][r]||(null===(u=e[i-1][r])||void 0===u?void 0:u.unitType.unitIsLiquid)),m=i<t-1&&(!e[i+1][r]||(null===(l=e[i+1][r])||void 0===l?void 0:l.unitType.unitIsLiquid)),g=S&&m;if(f)if(null===(d=e[i][r-1])||void 0===d?void 0:d.unitType.unitIsLiquid){if(r<t-1)if(e[i][r+1])i>0&&!e[i-1][r]?(y=e[i-1][r],e[i-1][r]=e[i][r],e[i][r]=y):i<t-1&&!e[i+1][r]?(y=e[i+1][r],e[i+1][r]=e[i][r],e[i][r]=y):(y=e[i][r-1],e[i][r-1]=e[i][r],e[i][r]=y);else{var y=e[i][r-1];e[i][r-1]=e[i][r],e[i][r]=y}}else e[i][r-1]||(e[i][r-1]=e[i][r],e[i][r-1].isUpdated=!0,e[i][r]=null);else if(p&&g){var w=(0,n.default)(0,1);s(i,r,0===w?i-1:i+1,r-1)}else c&&S?s(i,r,i-1,r-1):v&&m&&s(i,r,i+1,r-1)}}(i,r))},h=function(t,i){var r,n;null!=e[t][i]&&((null===(r=e[t][i])||void 0===r?void 0:r.unitType.unitIsStatic)||(null===(n=e[t][i])||void 0===n?void 0:n.unitType.unitIsGas)||a(t,i))},u=0;u<t;u+=1)for(var l=0;l<t;l+=1)null!=e[l][u]&&((null===(i=e[l][u])||void 0===i?void 0:i.unitType.unitIsStatic)||(e[l][u].isUpdated=!1));for(u=0;u<t;u+=1){if(!1===Boolean((0,n.default)(0,1)))for(l=0;l<t;l+=1)h(l,u);else for(l=t-1;l>=0;l-=1)h(l,u)}for(u=0;u<t;u+=1)for(l=0;l<t;l+=1)if(null!=e[l][u])for(var d=0;d<t;d+=1)for(var f=0;f<t;f+=1)null!=e[l][u]&&f!==l&&d!==u&&(null===(r=e[f][d])||void 0===r?void 0:r.unitId)===(null===(o=e[l][u])||void 0===o?void 0:o.unitId)&&(console.error("this is copy"),e[f][d]=null);return e},e}();t.default=o},648:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0;var i=function(){function e(e){var t=this;this.pixelSize=1,this.wallColor=4278190080,this.lastFrameTime=(new Date).getTime(),this.getScreenSizeX=function(){return t.width},this.getScreenSizeY=function(){return t.height},this.getPixelsCount=function(){return t.width*t.height/Math.pow(t.pixelSize,2)},this.getPixelSize=function(){return t.pixelSize},this.canvas=e,this.width=this.canvas.width,this.height=this.canvas.height,this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))}return e.prototype.setScreenSize=function(e,t){this.canvas.width=e,this.canvas.height=t,this.width=this.canvas.width,this.height=this.canvas.height,this.imageData=this.ctx.createImageData(this.width,this.height),this.realPixels=new Uint32Array(this.imageData.data.buffer),this.virtualPixels=new Uint32Array(this.width/this.pixelSize*(this.height/this.pixelSize))},e.prototype.setPixelSize=function(e){this.pixelSize=e,this.setScreenSize(this.width,this.height)},e.prototype.render=function(){for(var e=function(e,t,i,r){return(r-t-1)*i+e},t=0;t<this.height/this.pixelSize;t++)for(var i=0;i<this.width/this.pixelSize;i++)for(var r=0;r<this.pixelSize;r++)for(var n=0;n<this.pixelSize;n++){var o=e(i*this.pixelSize+r,t*this.pixelSize+n,this.width,this.height),s=e(i,t,this.width/this.pixelSize,this.height/this.pixelSize);this.realPixels[o]=this.virtualPixels[s]}this.ctx.putImageData(this.imageData,0,0),this.ctx.font="10px serif",1e3/((new Date).getTime()-this.lastFrameTime)==1/0&&(this.lastFrameTime=(new Date).getTime()),this.ctx.fillText("FPS: ".concat(String(1e3/((new Date).getTime()-this.lastFrameTime))),0,10),this.ctx.fillStyle="red",this.lastFrameTime=(new Date).getTime()},e.prototype.getPixels=function(){return this.virtualPixels},e.prototype.setPixels=function(e){this.virtualPixels=e},e}();t.Renderer=i},199:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=0),this.isUpdated=!1,this.unitType=e,this.unitVelocityVector=t,this.unitId=i};t.default=i},283:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){var i=Math.ceil(e),r=Math.floor(t);return Math.floor(Math.random()*(r-i+1))+i}}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,i),o.exports}i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};!function(){i(213);var e=new(i(844).App);e.setScreenSize(1e3,1e3),e.setPixelSize(10),e.renderer.render(),e.start()}()}();